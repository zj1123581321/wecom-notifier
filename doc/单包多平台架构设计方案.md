# å•åŒ…å¤šå¹³å°æ¶æ„è®¾è®¡æ–¹æ¡ˆ

**ç‰ˆæœ¬**: v1.1
**æ›´æ–°æ—¥æœŸ**: 2026-01-31
**é€‚ç”¨èŒƒå›´**: wecom-notifier v0.3.0+
**æ¶æ„æ¨¡å¼**: å•åŒ…å¤šå¹³å° + åè®®æŠ½è±¡å±‚

---

## ğŸ“Œ v1.1 ä¸»è¦æ›´æ–°

**æ ¸å¿ƒæ¶æ„è°ƒæ•´**ï¼š
1. âœ… **å¼•å…¥åè®®å±‚**ï¼šå®šä¹‰ `SenderProtocol`ã€`RateLimiterProtocol`ã€`MessageConverterProtocol`
2. âœ… **WebhookPoolé‡æ„**ï¼šåˆ›å»º `WebhookPoolBase` æŠ½è±¡åŸºç±»ï¼Œå¹³å°æ± ç»§æ‰¿å¤ç”¨
3. âœ… **é€‚é…å™¨æ¨¡å¼**ï¼šåŒ…è£…ç°æœ‰ Senderï¼Œä¸ä¿®æ”¹åŸä»£ç ï¼Œä¿æŒå‘åå…¼å®¹
4. âœ… **ä¾èµ–ä¼˜åŒ–å¢å¼º**ï¼šæ·»åŠ è¿è¡Œæ—¶æ£€æŸ¥ï¼Œé¿å…å‡çº§å´©æºƒ
5. âœ… **å®æ–½å‘¨æœŸè°ƒæ•´**ï¼š3å‘¨ â†’ 4å‘¨ï¼Œå¢åŠ  Beta æµ‹è¯•é˜¶æ®µ

**å…³é”®ä¼˜åŠ¿**ï¼š
- ğŸ”´â†’ğŸŸ¢ æ ¸å¿ƒæ¶æ„é£é™©ä»**é«˜**é™è‡³**ä½**
- ğŸ¯ 100% å‘åå…¼å®¹ï¼ˆé€šè¿‡ `Message.__post_init__` è‡ªåŠ¨è½¬æ¢ï¼‰
- ğŸš€ é€‚é…å™¨é›¶æ€§èƒ½å¼€é”€
- ğŸ§© æ˜“äºæ‰©å±•ï¼ˆæ–°å¹³å°åªéœ€å®ç°åè®®ï¼‰

**vs v1.0 ä¸»è¦å·®å¼‚**ï¼š
| æ–¹é¢ | v1.0 | v1.1 |
|-----|------|------|
| WebhookPool | ç›´æ¥ç§»åˆ° `core/` | æå–åŸºç±»ï¼Œå¹³å°å­ç±»ç»§æ‰¿ |
| Senderæ¥å£ | æ— ç»Ÿä¸€æ¥å£ | å®šä¹‰ `SenderProtocol` |
| ä»£ç æ”¹åŠ¨ | é‡æ„ç°æœ‰ä»£ç  | é€‚é…å™¨åŒ…è£…ï¼Œæœ€å°æ”¹åŠ¨ |
| ä¾èµ–ç®¡ç† | å¯é€‰ä¾èµ– | å¯é€‰ä¾èµ– + è¿è¡Œæ—¶æ£€æŸ¥ |
| å®æ–½å‘¨æœŸ | 3å‘¨ | 4å‘¨ï¼ˆå¢åŠ Betaæµ‹è¯•ï¼‰ |
| é£é™©ç­‰çº§ | ä¸­-é«˜ | ä½ |

---

## ğŸ“‹ ç›®å½•

- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
- [2. ç›®å½•ç»“æ„è®¾è®¡](#2-ç›®å½•ç»“æ„è®¾è®¡)
- [3. æ ¸å¿ƒæ¨¡å—è®¾è®¡](#3-æ ¸å¿ƒæ¨¡å—è®¾è®¡)
- [4. å¹³å°å±‚è®¾è®¡](#4-å¹³å°å±‚è®¾è®¡)
- [5. å‘åå…¼å®¹è®¾è®¡](#5-å‘åå…¼å®¹è®¾è®¡)
- [6. ä¾èµ–ä¼˜åŒ–](#6-ä¾èµ–ä¼˜åŒ–)
- [7. ä½¿ç”¨ç¤ºä¾‹](#7-ä½¿ç”¨ç¤ºä¾‹)
- [8. å®æ–½è®¡åˆ’](#8-å®æ–½è®¡åˆ’)
- [9. æµ‹è¯•ç­–ç•¥](#9-æµ‹è¯•ç­–ç•¥)
- [10. å…³é”®æ³¨æ„äº‹é¡¹](#10-å…³é”®æ³¨æ„äº‹é¡¹)
- [11. é£é™©è¯„ä¼°ä¸ç¼“è§£](#11-é£é™©è¯„ä¼°ä¸ç¼“è§£)
- [12. æˆåŠŸæ ‡å‡†](#12-æˆåŠŸæ ‡å‡†)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

| ç›®æ ‡ | è¯´æ˜ |
|-----|------|
| âœ… **ä¿æŒå‘åå…¼å®¹** | ç°æœ‰ç”¨æˆ·ä»£ç æ— éœ€ä¿®æ”¹ |
| âœ… **ä»£ç å¤ç”¨** | æ ¸å¿ƒé€»è¾‘ç»Ÿä¸€ç®¡ç†ï¼Œé¿å…é‡å¤ |
| âœ… **æ˜“äºæ‰©å±•** | æ·»åŠ æ–°å¹³å°åªéœ€å®ç°é€‚é…å±‚ |
| âœ… **å•ä¸€å‘å¸ƒ** | ä¸€ä¸ªåŒ…ï¼Œç‰ˆæœ¬ç»Ÿä¸€ï¼Œé™ä½ç»´æŠ¤æˆæœ¬ |
| âœ… **ä¾èµ–ä¼˜åŒ–** | å°†å¯é€‰åŠŸèƒ½çš„ä¾èµ–æ”¹ä¸ºå¯é€‰å®‰è£… |

### 1.2 æ¶æ„ä¼˜åŠ¿

**ç›¸æ¯”ä¸‰å±‚æ¶æ„æ–¹æ¡ˆçš„ä¼˜åŠ¿**ï¼š

| æ–¹é¢ | ä¸‰å±‚æ¶æ„ | å•åŒ…å¤šå¹³å° |
|-----|---------|-----------|
| **åŒ…æ•°é‡** | 3ä¸ªç‹¬ç«‹åŒ… | 1ä¸ªåŒ… |
| **ç‰ˆæœ¬ç®¡ç†** | å¤æ‚ï¼ˆéœ€åŒæ­¥ï¼‰ | ç®€å•ï¼ˆç»Ÿä¸€ç‰ˆæœ¬ï¼‰ |
| **ç”¨æˆ·è¿ç§»** | å¯èƒ½éœ€è¦ | å®Œå…¨å…¼å®¹ |
| **ç»´æŠ¤æˆæœ¬** | é«˜ | ä½ |
| **å‘å¸ƒæµç¨‹** | å¤æ‚ï¼ˆ3æ¬¡å‘å¸ƒï¼‰ | ç®€å•ï¼ˆ1æ¬¡å‘å¸ƒï¼‰ |
| **å®æ–½å‘¨æœŸ** | 8-9å‘¨ | 3å‘¨ |

### 1.3 åŒ…åç­–ç•¥

**é€‰é¡¹1ï¼ˆæ¨èï¼‰**ï¼šä¿æŒåŒ…åä¸å˜
- PyPI: `wecom-notifier` â†’ `wecom-notifier` (v0.3.0+)
- åŒ…åï¼š`wecom_notifier` â†’ `wecom_notifier`
- ç†ç”±ï¼šé¿å…ç”¨æˆ·è¿ç§»ï¼Œåˆ©ç”¨å·²æœ‰å“ç‰Œ

**é€‰é¡¹2**ï¼šæ”¹åä¸ºé€šç”¨åç§°
- PyPI: `wecom-notifier` â†’ `notification-kit`
- åŒ…åï¼š`wecom_notifier` â†’ `notification_kit`
- ç†ç”±ï¼šæ›´é€šç”¨çš„åç§°ï¼Œä½†éœ€è¦ç”¨æˆ·è¿ç§»

**æœ€ç»ˆå†³ç­–**ï¼š**é‡‡ç”¨é€‰é¡¹1**ï¼Œåœ¨ v1.0.0 æ—¶å†è€ƒè™‘æ”¹åã€‚

### 1.4 ç°çŠ¶ä¸å·®è·ï¼ˆå¿…é¡»æ˜ç¡®ï¼‰

**å½“å‰ä»£ç ç°çŠ¶ï¼ˆåŸºäºç°æœ‰ä»“åº“ç»“æ„ï¼‰**ï¼š
- `wecom_notifier/` ä¸ºå•å±‚å¹³é“ºç»“æ„ï¼Œæ ¸å¿ƒé€»è¾‘ä¸å¹³å°é€»è¾‘æ··æ‚
- ä»…æ”¯æŒä¼ä¸šå¾®ä¿¡ï¼ˆwecomï¼‰ï¼Œæ—  `core/` ä¸ `platforms/` åˆ†å±‚
- ç°æœ‰ `webhook_pool.py`ã€`sender.py`ã€`manager.py` ç­‰é«˜åº¦è€¦åˆ
- README ä¸ç¤ºä¾‹å®Œå…¨å›´ç»•ä¼ä¸šå¾®ä¿¡åœºæ™¯

**ä¸ç›®æ ‡æ¶æ„çš„ä¸»è¦å·®è·**ï¼š
- éœ€è¦è¿›è¡Œ**ç›®å½•é‡æ’ä¸æ¨¡å—é‡å®šä½**ï¼ˆéçº¯å¢é‡å˜æ›´ï¼‰
- éœ€è¦å¼•å…¥**åè®®å±‚ä¸é€‚é…å™¨**ï¼Œé‡å¡‘è°ƒç”¨é“¾è·¯
- éœ€è¦æ„å»º**å…¼å®¹å¯¼å‡ºå±‚**ï¼Œä¿è¯æ—§å¯¼å…¥è·¯å¾„ä¸è¡Œä¸ºä¸å˜
- éœ€è¦æ–°å¢å¹³å°ï¼ˆé£ä¹¦ï¼‰ä¸å¯¹åº”æµ‹è¯•ä½“ç³»

**ç»“è®º**ï¼šæœ¬æ–¹æ¡ˆå±äº**ä¸­ç­‰è§„æ¨¡é‡æ„ + æ–°å¹³å°å¼•å…¥**ï¼Œå¿…é¡»ä»¥â€œå…¼å®¹ä¼˜å…ˆâ€çš„æ¸è¿›å¼æ”¹é€ ä¸ºå‰æã€‚

---

## 2. ç›®å½•ç»“æ„è®¾è®¡

### 2.1 å®Œæ•´ç›®å½•ç»“æ„

```
wecom-notifier/
â”œâ”€â”€ wecom_notifier/                    # ä¸»åŒ…
â”‚   â”œâ”€â”€ __init__.py                    # å‘åå…¼å®¹å¯¼å‡º
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                          # æ ¸å¿ƒæ¨¡å—ï¼ˆå¹³å°æ— å…³ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ protocols.py               # ğŸ†• åè®®å®šä¹‰ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
â”‚   â”‚   â”œâ”€â”€ rate_limiter.py            # é¢‘ç‡æ§åˆ¶ç®—æ³•
â”‚   â”‚   â”œâ”€â”€ segmenter.py               # æ¶ˆæ¯åˆ†æ®µå™¨
â”‚   â”‚   â”œâ”€â”€ pool_base.py               # ğŸ†• Webhookæ± åŸºç±»
â”‚   â”‚   â”œâ”€â”€ webhook_resource.py        # Webhookèµ„æº
â”‚   â”‚   â”œâ”€â”€ models.py                  # æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼ˆè°ƒæ•´ï¼‰
â”‚   â”‚   â”œâ”€â”€ constants.py               # æ ¸å¿ƒå¸¸é‡ï¼ˆä»…é€šç”¨å¸¸é‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ exceptions.py              # æ ¸å¿ƒå¼‚å¸¸
â”‚   â”‚   â”œâ”€â”€ logger.py                  # æ—¥å¿—å·¥å…·
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ moderation/                # å†…å®¹å®¡æ ¸æ¨¡å—
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ moderator.py           # å®¡æ ¸å™¨ä¸»ç±»ï¼ˆæ·»åŠ è¿è¡Œæ—¶æ£€æŸ¥ï¼‰
â”‚   â”‚       â”œâ”€â”€ filter.py              # å†…å®¹è¿‡æ»¤
â”‚   â”‚       â”œâ”€â”€ strategies.py          # å®¡æ ¸ç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ word_loader.py         # æ•æ„Ÿè¯åŠ è½½
â”‚   â”‚       â””â”€â”€ sensitive_logger.py    # æ•æ„Ÿæ¶ˆæ¯æ—¥å¿—
â”‚   â”‚
â”‚   â”œâ”€â”€ platforms/                     # å¹³å°é€‚é…å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ wecom/                     # ä¼ä¸šå¾®ä¿¡å¹³å°
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ notifier.py            # WeComNotifier ä¸»ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ sender.py              # HTTP å‘é€å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ manager.py             # Webhookç®¡ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ pool.py                # ğŸ”„ Webhookæ± ï¼ˆç»§æ‰¿pool_baseï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ adapter.py             # ğŸ†• åè®®é€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py              # ä¼å¾®ç‰¹å®šé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ constants.py           # ä¼å¾®å¸¸é‡
â”‚   â”‚   â”‚   â””â”€â”€ exceptions.py          # ä¼å¾®å¼‚å¸¸
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ feishu/                    # é£ä¹¦å¹³å°ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ notifier.py            # FeishuNotifier ä¸»ç±»
â”‚   â”‚       â”œâ”€â”€ sender.py              # HTTP å‘é€å™¨
â”‚   â”‚       â”œâ”€â”€ manager.py             # Webhookç®¡ç†å™¨
â”‚   â”‚       â”œâ”€â”€ pool.py                # Webhookæ± ï¼ˆç»§æ‰¿pool_baseï¼‰
â”‚   â”‚       â”œâ”€â”€ adapter.py             # ğŸ†• åè®®é€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ rate_limiter.py        # åŒå±‚é¢‘ç‡æ§åˆ¶
â”‚   â”‚       â”œâ”€â”€ config.py              # é£ä¹¦ç‰¹å®šé…ç½®
â”‚   â”‚       â”œâ”€â”€ constants.py           # é£ä¹¦å¸¸é‡
â”‚   â”‚       â””â”€â”€ exceptions.py          # é£ä¹¦å¼‚å¸¸
â”‚   â”‚
â”‚   # å‘åå…¼å®¹æ¨¡å—ï¼ˆä¿æŒç°æœ‰å¯¼å…¥è·¯å¾„ï¼‰
â”‚   â”œâ”€â”€ notifier.py        â†’ platforms/wecom/notifier.py
â”‚   â”œâ”€â”€ sender.py          â†’ platforms/wecom/sender.py
â”‚   â”œâ”€â”€ webhook_manager.py â†’ platforms/wecom/manager.py
â”‚   â”œâ”€â”€ webhook_pool.py    â†’ platforms/wecom/pool.pyï¼ˆæ–°å¢å…¼å®¹ï¼‰
â”‚   â”œâ”€â”€ models.py          â†’ core/models.py
â”‚   â”œâ”€â”€ constants.py       â†’ core/constants.py + platforms/wecom/constants.py
â”‚   â”œâ”€â”€ exceptions.py      â†’ core/exceptions.py + platforms/wecom/exceptions.py
â”‚   â””â”€â”€ logger.py          â†’ core/logger.py
â”‚
â”œâ”€â”€ tests/                             # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ core/                          # æ ¸å¿ƒæ¨¡å—æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_rate_limiter.py
â”‚   â”‚   â”œâ”€â”€ test_segmenter.py
â”‚   â”‚   â”œâ”€â”€ test_webhook_pool.py
â”‚   â”‚   â””â”€â”€ test_moderation.py
â”‚   â”‚
â”‚   â”œâ”€â”€ platforms/
â”‚   â”‚   â”œâ”€â”€ wecom/                     # ä¼å¾®æµ‹è¯•
â”‚   â”‚   â”‚   â”œâ”€â”€ test_notifier.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_sender.py
â”‚   â”‚   â”‚   â””â”€â”€ test_manager.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ feishu/                    # é£ä¹¦æµ‹è¯•
â”‚   â”‚       â”œâ”€â”€ test_notifier.py
â”‚   â”‚       â”œâ”€â”€ test_sender.py
â”‚   â”‚       â”œâ”€â”€ test_converter.py
â”‚   â”‚       â””â”€â”€ test_rate_limiter.py
â”‚   â”‚
â”‚   â””â”€â”€ test_backward_compatibility.py  # å‘åå…¼å®¹æµ‹è¯•
â”‚
â”œâ”€â”€ examples/                          # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ wecom_basic.py                 # ä¼å¾®åŸºç¡€ç¤ºä¾‹
â”‚   â”œâ”€â”€ wecom_advanced.py              # ä¼å¾®é«˜çº§ç¤ºä¾‹
â”‚   â”œâ”€â”€ feishu_basic.py                # é£ä¹¦åŸºç¡€ç¤ºä¾‹
â”‚   â”œâ”€â”€ feishu_advanced.py             # é£ä¹¦é«˜çº§ç¤ºä¾‹
â”‚   â””â”€â”€ multi_platform.py              # å¤šå¹³å°ç¤ºä¾‹
â”‚
â”œâ”€â”€ doc/                               # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ wecom_usage.md                 # ä¼å¾®ä½¿ç”¨æ–‡æ¡£
â”‚   â”œâ”€â”€ feishu_usage.md                # é£ä¹¦ä½¿ç”¨æ–‡æ¡£
â”‚   â”œâ”€â”€ migration_guide.md             # è¿ç§»æŒ‡å—ï¼ˆå¦‚æœéœ€è¦ï¼‰
â”‚   â”œâ”€â”€ architecture.md                # æ¶æ„è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ å•åŒ…å¤šå¹³å°æ¶æ„è®¾è®¡æ–¹æ¡ˆ.md       # æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ pyproject.toml                     # é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md                          # ä¸»è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ CHANGELOG.md                       # å˜æ›´æ—¥å¿—
â”œâ”€â”€ LICENSE                            # è®¸å¯è¯
â””â”€â”€ requirements.txt                   # ä¾èµ–åˆ—è¡¨
```

### 2.2 ç›®å½•èŒè´£è¯´æ˜

| ç›®å½• | èŒè´£ | å¹³å°ç›¸å…³æ€§ |
|-----|------|-----------|
| **core/protocols.py** | ğŸ†• åè®®å®šä¹‰ï¼ˆç»Ÿä¸€æ¥å£æŠ½è±¡ï¼‰ | å¹³å°æ— å…³ |
| **core/pool_base.py** | ğŸ†• Webhookæ± åŸºç±»ï¼ˆé€šç”¨è°ƒåº¦é€»è¾‘ï¼‰ | å¹³å°æ— å…³ |
| **core/** | æ ¸å¿ƒç®—æ³•å’Œæ•°æ®ç»“æ„ | å¹³å°æ— å…³ |
| **core/moderation/** | å†…å®¹å®¡æ ¸åŠŸèƒ½ï¼ˆæ·»åŠ è¿è¡Œæ—¶æ£€æŸ¥ï¼‰ | å¹³å°æ— å…³ |
| **platforms/wecom/adapter.py** | ğŸ†• ä¼å¾®åè®®é€‚é…å™¨ | ä¼å¾®ä¸“ç”¨ |
| **platforms/wecom/pool.py** | ğŸ”„ ä¼å¾®Webhookæ± ï¼ˆç»§æ‰¿åŸºç±»ï¼‰ | ä¼å¾®ä¸“ç”¨ |
| **platforms/wecom/** | ä¼ä¸šå¾®ä¿¡é€‚é…å±‚ | ä¼å¾®ä¸“ç”¨ |
| **platforms/feishu/adapter.py** | ğŸ†• é£ä¹¦åè®®é€‚é…å™¨ | é£ä¹¦ä¸“ç”¨ |
| **platforms/feishu/pool.py** | ğŸ†• é£ä¹¦Webhookæ± ï¼ˆç»§æ‰¿åŸºç±»ï¼‰ | é£ä¹¦ä¸“ç”¨ |
| **platforms/feishu/** | é£ä¹¦é€‚é…å±‚ | é£ä¹¦ä¸“ç”¨ |
| **æ ¹ç›®å½•å…¼å®¹æ¨¡å—** | å‘åå…¼å®¹ | ä¼å¾®ä¸“ç”¨ |

---

## 3. åè®®å±‚è®¾è®¡ï¼ˆæ ¸å¿ƒæŠ½è±¡ï¼‰

### 3.1 è®¾è®¡åŸåˆ™

**é—®é¢˜**ï¼šä¼å¾®å’Œé£ä¹¦çš„APIå·®å¼‚è¾ƒå¤§ï¼Œå¦‚ä½•å®ç°ä»£ç å¤ç”¨ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šå¼•å…¥**åè®®å±‚**ï¼ˆProtocolï¼‰ï¼Œå®šä¹‰å¹³å°æ— å…³çš„ç»Ÿä¸€æ¥å£ã€‚

```
ç”¨æˆ·ä»£ç 
    â†“
WeComNotifier / FeishuNotifierï¼ˆå¹³å°ä¸»ç±»ï¼‰
    â†“
WebhookPoolï¼ˆé€šç”¨æ± åŸºç±»ï¼‰
    â†“
SenderProtocolï¼ˆåè®®æ¥å£ï¼‰ â† å…³é”®æŠ½è±¡å±‚
    â†“ â†“
WeComSenderAdapter    FeishuSenderAdapterï¼ˆé€‚é…å™¨ï¼‰
    â†“ â†“
WeComSender           FeishuSenderï¼ˆåŸç”Ÿå®ç°ï¼‰
```

### 3.2 æ ¸å¿ƒåè®®å®šä¹‰ï¼ˆcore/protocols.pyï¼‰

```python
"""ç»Ÿä¸€åè®®å®šä¹‰ - å¹³å°æ— å…³çš„æŠ½è±¡æ¥å£"""
from typing import Protocol, Tuple, Optional, Any
from abc import abstractmethod


class SenderProtocol(Protocol):
    """å‘é€å™¨åè®® - æ‰€æœ‰å¹³å°çš„Senderå¿…é¡»å®ç°"""

    @abstractmethod
    def send(
        self,
        webhook_url: str,
        msg_type: str,
        content: Any,
        metadata: Optional[dict] = None
    ) -> Tuple[bool, Optional[str]]:
        """
        ç»Ÿä¸€å‘é€æ¥å£

        Args:
            webhook_url: Webhookåœ°å€
            msg_type: æ¶ˆæ¯ç±»å‹ï¼ˆå¹³å°è‡ªå®šä¹‰ï¼‰
            content: æ¶ˆæ¯å†…å®¹
            metadata: å¹³å°ç‰¹å®šå…ƒæ•°æ®

        Returns:
            (æ˜¯å¦æˆåŠŸ, é”™è¯¯ä¿¡æ¯)
        """
        ...


class RateLimiterProtocol(Protocol):
    """é¢‘ç‡æ§åˆ¶å™¨åè®® - æ”¯æŒå•å±‚/åŒå±‚é¢‘æ§"""

    @abstractmethod
    def acquire(self) -> None:
        """è·å–å‘é€è®¸å¯ï¼ˆé˜»å¡ï¼‰"""
        ...

    @abstractmethod
    def get_available_count(self) -> int:
        """è¿”å›å½“å‰å¯ç”¨é…é¢"""
        ...

    @abstractmethod
    def is_available_now(self) -> bool:
        """å½“å‰æ˜¯å¦æœ‰é…é¢"""
        ...


class MessageConverterProtocol(Protocol):
    """æ¶ˆæ¯è½¬æ¢å™¨åè®® - å°†é€šç”¨Messageè½¬æ¢ä¸ºå¹³å°æ ¼å¼"""

    @abstractmethod
    def prepare_send_params(
        self,
        msg_type: str,
        content: Any,
        message_metadata: dict
    ) -> Tuple[str, Any, dict]:
        """
        å‡†å¤‡å‘é€å‚æ•°

        Returns:
            (å¹³å°msg_type, å¹³å°content, å¹³å°metadata)
        """
        ...
```

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- âœ… å¹³å°æ— å…³ï¼šWebhookPoolä¾èµ–åè®®è€Œéå…·ä½“å®ç°
- âœ… æ˜“äºæµ‹è¯•ï¼šå¯ä»¥Mockåè®®è¿›è¡Œå•å…ƒæµ‹è¯•
- âœ… æ˜“äºæ‰©å±•ï¼šæ–°å¹³å°åªéœ€å®ç°åè®®å³å¯
- âœ… å‘åå…¼å®¹ï¼šé€šè¿‡é€‚é…å™¨åŒ…è£…ç°æœ‰ä»£ç 

### 3.3 é€‚é…å™¨æ¨¡å¼åº”ç”¨

**ä¼å¾®é€‚é…å™¨ç¤ºä¾‹**ï¼ˆplatforms/wecom/adapter.pyï¼‰ï¼š

```python
class WeComSenderAdapter(SenderProtocol):
    """åŒ…è£…ç°æœ‰çš„WeComSenderï¼Œå®ç°ç»Ÿä¸€åè®®"""

    def __init__(self, sender: WeComSender):
        self._sender = sender  # åŒ…è£…åŸç”Ÿsender

    def send(self, webhook_url, msg_type, content, metadata=None):
        """ç»Ÿä¸€æ¥å£ â†’ è°ƒç”¨ä¼å¾®åŸç”Ÿæ–¹æ³•"""
        if msg_type == MSG_TYPE_TEXT:
            return self._sender.send_text(
                webhook_url,
                content,
                mentioned_list=metadata.get('mentioned_list'),
                mentioned_mobile_list=metadata.get('mentioned_mobile_list')
            )
        elif msg_type == MSG_TYPE_MARKDOWN_V2:
            return self._sender.send_markdown(webhook_url, content)
        # ...
```

**å¥½å¤„**ï¼š
- ä¸ä¿®æ”¹ç°æœ‰ `WeComSender` ä»£ç 
- ä¿æŒå‘åå…¼å®¹
- é€šè¿‡é€‚é…å™¨æ¡¥æ¥æ–°æ—§æ¶æ„

---

## 4. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 4.1 æ ¸å¿ƒå¸¸é‡ (core/constants.py)

```python
"""æ ¸å¿ƒå¸¸é‡ - å¹³å°æ— å…³é…ç½®"""

# é¢‘ç‡é™åˆ¶
DEFAULT_RATE_LIMIT = 20
DEFAULT_TIME_WINDOW = 60

# åˆ†æ®µè®¾ç½®
DEFAULT_SEGMENT_INTERVAL = 1000  # æ¯«ç§’

# é‡è¯•è®¾ç½®
DEFAULT_MAX_RETRIES = 3
DEFAULT_RETRY_DELAY = 2.0
DEFAULT_BACKOFF_FACTOR = 2.0

# HTTPè®¾ç½®
DEFAULT_TIMEOUT = 10

# Markdownè¯­æ³•æ ‡è®°
MARKDOWN_LINK_PATTERN = r'\[([^\]]+)\]\(([^)]+)\)'
MARKDOWN_IMAGE_PATTERN = r'!\[([^\]]*)\]\(([^)]+)\)'
MARKDOWN_CODE_BLOCK_PATTERN = r'```[\s\S]*?```'
MARKDOWN_TABLE_ROW_PATTERN = r'^\|.*\|$'

# é¡µç æ ¼å¼
PAGE_INDICATOR_FORMAT = "(Page {current}/{total})\n"
MAX_PAGE_INDICATOR_BYTES = 20
```

### 4.2 æ ¸å¿ƒæ•°æ®æ¨¡å‹ (core/models.py)

```python
"""æ ¸å¿ƒæ•°æ®æ¨¡å‹"""
import uuid
import threading
from typing import Optional, List, Any
from dataclasses import dataclass, field


@dataclass
class Message:
    """
    é€šç”¨æ¶ˆæ¯æ¨¡å‹

    è®¾è®¡åŸåˆ™ï¼š
    - æ ¸å¿ƒå­—æ®µä¿æŒå¹³å°æ— å…³
    - å¹³å°ç‰¹å®šæ•°æ®æ”¾åœ¨ platform_extras
    - é€šè¿‡ __post_init__ å®ç°å‘åå…¼å®¹
    """
    content: Any  # æ¶ˆæ¯å†…å®¹ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡æ•°æ®ç­‰ï¼‰
    msg_type: str  # æ¶ˆæ¯ç±»å‹ï¼ˆå¹³å°è‡ªå®šä¹‰ï¼‰
    id: str = field(default_factory=lambda: str(uuid.uuid4()))

    # é€šç”¨@åŠŸèƒ½
    mention_all: bool = False

    # å¹³å°ç‰¹å®šæ‰©å±•
    platform_extras: dict = field(default_factory=dict)

    # å‘é€é…ç½®
    segment_interval: int = 1000  # æ¯«ç§’

    # ğŸ”„ å‘åå…¼å®¹å­—æ®µï¼ˆä¼å¾®ï¼‰
    mentioned_list: Optional[List[str]] = None
    mentioned_mobile_list: Optional[List[str]] = None

    def __post_init__(self):
        """åˆå§‹åŒ–åå¤„ç† - å…¼å®¹æ€§è½¬æ¢"""
        # å¦‚æœè®¾ç½®äº† mentioned_listï¼Œè‡ªåŠ¨æ”¾å…¥ platform_extras
        if self.mentioned_list or self.mentioned_mobile_list:
            if 'wecom' not in self.platform_extras:
                self.platform_extras['wecom'] = {}
            if self.mentioned_list:
                self.platform_extras['wecom']['mentioned_list'] = self.mentioned_list
            if self.mentioned_mobile_list:
                self.platform_extras['wecom']['mentioned_mobile_list'] = self.mentioned_mobile_list


@dataclass
class SegmentInfo:
    """åˆ†æ®µä¿¡æ¯"""
    content: str
    is_first: bool = True
    is_last: bool = True
    page_number: Optional[int] = None
    total_pages: Optional[int] = None


class SendResult:
    """å‘é€ç»“æœï¼ˆå¹³å°æ— å…³ï¼‰"""

    def __init__(self, message_id: str):
        self.message_id = message_id
        self.success: Optional[bool] = None
        self.error: Optional[str] = None
        self._event = threading.Event()

        # Webhookæ± æ¨¡å¼ä¸“ç”¨
        self.used_webhooks: List[str] = []
        self.segment_count: int = 0

    def mark_success(self):
        self.success = True
        self._event.set()

    def mark_failed(self, error: str):
        self.success = False
        self.error = error
        self._event.set()

    def wait(self, timeout: Optional[float] = None) -> bool:
        return self._event.wait(timeout)

    def is_success(self) -> bool:
        return self.success is True
```

### 4.3 æ ¸å¿ƒå¼‚å¸¸ (core/exceptions.py)

```python
"""æ ¸å¿ƒå¼‚å¸¸å®šä¹‰"""


class NotificationError(Exception):
    """é€šçŸ¥åº“åŸºç¡€å¼‚å¸¸"""
    pass


class NetworkError(NotificationError):
    """ç½‘ç»œé”™è¯¯ï¼ˆè¶…æ—¶ã€è¿æ¥å¤±è´¥ï¼‰"""
    pass


class ConfigurationError(NotificationError):
    """é…ç½®é”™è¯¯"""
    pass


class ModerationError(NotificationError):
    """å†…å®¹å®¡æ ¸é”™è¯¯"""
    pass


class SegmentationError(NotificationError):
    """åˆ†æ®µé”™è¯¯"""
    pass
```

### 4.4 é€šç”¨ Webhook æ± åŸºç±»ï¼ˆcore/pool_base.pyï¼‰

**æ ¸å¿ƒè®¾è®¡**ï¼šå°†ç°æœ‰çš„ `webhook_pool.py` çš„é€šç”¨é€»è¾‘æå–ä¸ºåŸºç±»ã€‚

```python
class WebhookPoolBase(ABC):
    """
    Webhookæ± åŸºç±»

    æä¾›é€šç”¨çš„è°ƒåº¦é€»è¾‘ï¼Œå¹³å°ç‰¹å®šè¡Œä¸ºç”±å­ç±»å®ç°
    """

    def __init__(
        self,
        resources: List[WebhookResource],
        sender: SenderProtocol,  # â† ä¾èµ–åè®®
        segmenter: MessageSegmenter,
        converter: MessageConverterProtocol,  # â† æ¶ˆæ¯è½¬æ¢å™¨
        content_moderator: Optional['ContentModerator'] = None
    ):
        # åˆå§‹åŒ–é€»è¾‘...

    def _process_message(self, message: Message):
        """å¤„ç†å•æ¡æ¶ˆæ¯ï¼ˆé€šç”¨æµç¨‹ï¼‰"""
        # 1. åˆ†æ®µ
        segments = self._get_segments(message)

        # 2. å®¡æ ¸
        if self.content_moderator:
            segments = self._moderate_segments(message, segments)

        # 3. è½¬æ¢æ¶ˆæ¯å‚æ•°
        msg_type, content, metadata = self.converter.prepare_send_params(...)

        # 4. å‘é€æ¯ä¸ªåˆ†æ®µ
        for segment in segments:
            self._send_segment_with_retry(...)

        # 5. å¹³å°ç‰¹å®šåå¤„ç†
        self._post_send_hook(message, used_webhooks)

    # ===== æŠ½è±¡æ–¹æ³•ï¼šç”±å­ç±»å®ç° =====

    @abstractmethod
    def should_skip_segmentation(self, msg_type: str) -> bool:
        """æ˜¯å¦è·³è¿‡åˆ†æ®µï¼ˆå¦‚ä¼å¾®çš„å›¾ç‰‡æ¶ˆæ¯ï¼‰"""
        pass

    @abstractmethod
    def should_skip_moderation(self, msg_type: str) -> bool:
        """æ˜¯å¦è·³è¿‡å®¡æ ¸ï¼ˆå¦‚å›¾ç‰‡æ¶ˆæ¯ï¼‰"""
        pass

    @abstractmethod
    def _post_send_hook(self, message: Message, used_webhooks: set) -> bool:
        """
        å‘é€åé’©å­ï¼ˆå¹³å°ç‰¹å®šå¤„ç†ï¼‰

        ä¾‹å¦‚ï¼šä¼å¾®çš„ @all workaround
        """
        pass
```

**å…³é”®ä¼˜åŠ¿**ï¼š
- âœ… è°ƒåº¦é€»è¾‘å¤ç”¨ï¼ˆä¸²è¡Œå¤„ç†ã€æ™ºèƒ½é€‰æ‹©webhookã€é‡è¯•ï¼‰
- âœ… å¹³å°å·®å¼‚é€šè¿‡æŠ½è±¡æ–¹æ³•è§£å†³
- âœ… ä¾èµ–åè®®è€Œéå…·ä½“å®ç°

### 4.5 æ ¸å¿ƒæ¨¡å—åˆ—è¡¨

| æ¨¡å— | æ–‡ä»¶ | è¯´æ˜ | å¤ç”¨æ€§ |
|-----|------|------|--------|
| **åè®®å®šä¹‰** | `protocols.py` | ğŸ†• ç»Ÿä¸€æ¥å£æŠ½è±¡ | 100% |
| **Webhookæ± åŸºç±»** | `pool_base.py` | ğŸ†• é€šç”¨è°ƒåº¦é€»è¾‘ | ç»§æ‰¿å¤ç”¨ |
| **é¢‘ç‡æ§åˆ¶** | `rate_limiter.py` | æ»‘åŠ¨çª—å£ç®—æ³• | 100% |
| **æ¶ˆæ¯åˆ†æ®µ** | `segmenter.py` | Markdownæ™ºèƒ½åˆ†æ®µ | 100% |
| **å†…å®¹å®¡æ ¸** | `moderation/` | ACè‡ªåŠ¨æœº+ç­–ç•¥ï¼ˆæ·»åŠ è¿è¡Œæ—¶æ£€æŸ¥ï¼‰ | 100% |
| **æ—¥å¿—ç³»ç»Ÿ** | `logger.py` | loguruå°è£… | 100% |
| **æ•°æ®æ¨¡å‹** | `models.py` | é€šç”¨æ•°æ®ç»“æ„ï¼ˆè°ƒæ•´ï¼‰ | 100% |

**è¯´æ˜**ï¼š
- **100%å¤ç”¨**ï¼šæ— éœ€ä¿®æ”¹ï¼Œç›´æ¥ä½¿ç”¨
- **ç»§æ‰¿å¤ç”¨**ï¼šé€šè¿‡ç»§æ‰¿åŸºç±»å®ç°å¹³å°ç‰¹å®šé€»è¾‘

---

## 5. å¹³å°å±‚è®¾è®¡

### 5.1 ä¼ä¸šå¾®ä¿¡å¹³å° (platforms/wecom/)

**æ¶æ„è°ƒæ•´**ï¼š
- åŸæœ‰ä»£ç ä¿æŒä¸å˜ï¼ˆ`notifier.py`, `sender.py`, `manager.py`ï¼‰
- æ–°å¢ `adapter.py`ï¼ˆåè®®é€‚é…å™¨ï¼‰
- è°ƒæ•´ `pool.py`ï¼ˆç»§æ‰¿ `WebhookPoolBase`ï¼‰

#### 5.1.1 å¹³å°é…ç½® (config.py)

```python
"""ä¼ä¸šå¾®ä¿¡å¹³å°é…ç½®"""

# æ¶ˆæ¯ç±»å‹
MSG_TYPE_TEXT = "text"
MSG_TYPE_MARKDOWN_V2 = "markdown_v2"
MSG_TYPE_IMAGE = "image"

# åˆ†æ®µè®¾ç½®
MAX_BYTES_PER_MESSAGE = 3800  # å®é™…é™åˆ¶4096ï¼Œç•™å®‰å…¨ä½™é‡

# é¢‘ç‡é™åˆ¶
RATE_LIMIT_PER_MINUTE = 20
RATE_LIMIT_PER_SECOND = None  # ä¼å¾®æ— ç§’çº§é™åˆ¶

# æœåŠ¡ç«¯é¢‘æ§é‡è¯•
RATE_LIMIT_MAX_RETRIES = 5
RATE_LIMIT_WAIT_TIME = 65

# é”™è¯¯ç 
ERRCODE_SUCCESS = 0
ERRCODE_WEBHOOK_INVALID = 93000
ERRCODE_RATE_LIMIT = 45009

# Webhook URLæ ¼å¼
WEBHOOK_URL_PATTERN = r"https://qyapi\.weixin\.qq\.com/cgi-bin/webhook/send\?key=[\w-]+"
```

#### 5.1.2 åè®®é€‚é…å™¨ï¼ˆadapter.pyï¼‰ğŸ†•

**ä½œç”¨**ï¼šå°†ç°æœ‰çš„ `WeComSender` åŒ…è£…ä¸ºç¬¦åˆ `SenderProtocol` çš„é€‚é…å™¨ã€‚

```python
"""ä¼ä¸šå¾®ä¿¡å¹³å°é€‚é…å™¨"""
from wecom_notifier.core.protocols import SenderProtocol, MessageConverterProtocol
from .sender import Sender as WeComSender
from .constants import MSG_TYPE_TEXT, MSG_TYPE_MARKDOWN_V2, MSG_TYPE_IMAGE


class WeComSenderAdapter(SenderProtocol):
    """ä¼å¾®å‘é€å™¨é€‚é…å™¨ - åŒ…è£…ç°æœ‰Sender"""

    def __init__(self, sender: WeComSender):
        self._sender = sender  # åŒ…è£…åŸç”Ÿsender

    def send(
        self,
        webhook_url: str,
        msg_type: str,
        content: Any,
        metadata: Optional[dict] = None
    ) -> Tuple[bool, Optional[str]]:
        """ç»Ÿä¸€å‘é€æ¥å£ â†’ è°ƒç”¨ä¼å¾®åŸç”Ÿæ–¹æ³•"""
        metadata = metadata or {}

        if msg_type == MSG_TYPE_TEXT:
            return self._sender.send_text(
                webhook_url,
                content,
                mentioned_list=metadata.get('mentioned_list'),
                mentioned_mobile_list=metadata.get('mentioned_mobile_list')
            )
        elif msg_type == MSG_TYPE_MARKDOWN_V2:
            return self._sender.send_markdown(webhook_url, content)
        elif msg_type == MSG_TYPE_IMAGE:
            # ... å›¾ç‰‡é€»è¾‘
        else:
            return False, f"Unsupported message type: {msg_type}"


class WeComMessageConverter(MessageConverterProtocol):
    """ä¼å¾®æ¶ˆæ¯è½¬æ¢å™¨"""

    def prepare_send_params(
        self,
        msg_type: str,
        content: Any,
        message_metadata: dict
    ) -> Tuple[str, Any, dict]:
        """å‡†å¤‡ä¼å¾®å‘é€å‚æ•°"""
        wecom_extras = message_metadata.get('wecom', {})

        metadata = {}
        if 'mentioned_list' in wecom_extras:
            metadata['mentioned_list'] = wecom_extras['mentioned_list']
        if 'mentioned_mobile_list' in wecom_extras:
            metadata['mentioned_mobile_list'] = wecom_extras['mentioned_mobile_list']

        # ä¼å¾®ä¸éœ€è¦è½¬æ¢ msg_type å’Œ content
        return msg_type, content, metadata

    def needs_mention_all_workaround(self, msg_type: str) -> bool:
        """markdown_v2 å’Œ image éœ€è¦@all workaround"""
        return msg_type in (MSG_TYPE_MARKDOWN_V2, MSG_TYPE_IMAGE)
```

**å…³é”®ç‚¹**ï¼š
- âœ… ä¸ä¿®æ”¹åŸæœ‰ `WeComSender` ä»£ç 
- âœ… é€šè¿‡é€‚é…å™¨æ¡¥æ¥æ–°æ—§æ¶æ„
- âœ… ä¿æŒå‘åå…¼å®¹

#### 5.1.3 Webhookæ± å®ç°ï¼ˆpool.pyï¼‰ğŸ”„

**è°ƒæ•´**ï¼šä» `core/` ç§»è‡³ `platforms/wecom/`ï¼Œç»§æ‰¿ `WebhookPoolBase`ã€‚

```python
"""ä¼ä¸šå¾®ä¿¡ Webhook æ± """
from wecom_notifier.core.pool_base import WebhookPoolBase
from wecom_notifier.core.models import Message
from .constants import MSG_TYPE_IMAGE
from .adapter import WeComSenderAdapter, WeComMessageConverter


class WeComWebhookPool(WebhookPoolBase):
    """ä¼ä¸šå¾®ä¿¡ Webhook æ±  - ç»§æ‰¿é€šç”¨æ± é€»è¾‘"""

    def __init__(self, resources, sender, segmenter, content_moderator=None):
        # åŒ…è£…ä¸ºé€‚é…å™¨
        if not isinstance(sender, SenderProtocol):
            sender = WeComSenderAdapter(sender)

        converter = WeComMessageConverter()

        super().__init__(
            resources=resources,
            sender=sender,
            segmenter=segmenter,
            converter=converter,
            content_moderator=content_moderator
        )

        # ä¿å­˜åŸç”Ÿsenderï¼ˆç”¨äº@all workaroundï¼‰
        self._raw_sender = sender._sender if hasattr(sender, '_sender') else None

    # ===== å®ç°æŠ½è±¡æ–¹æ³• =====

    def should_skip_segmentation(self, msg_type: str) -> bool:
        """å›¾ç‰‡æ¶ˆæ¯ä¸åˆ†æ®µ"""
        return msg_type == MSG_TYPE_IMAGE

    def should_skip_moderation(self, msg_type: str) -> bool:
        """å›¾ç‰‡æ¶ˆæ¯ä¸å®¡æ ¸"""
        return msg_type == MSG_TYPE_IMAGE

    def _post_send_hook(self, message: Message, used_webhooks: set) -> bool:
        """ä¼å¾®ç‰¹å®šï¼š@all workaround"""
        if not message.mention_all:
            return True

        converter = WeComMessageConverter()
        if not converter.needs_mention_all_workaround(message.msg_type):
            return True

        # å‘é€ @all æ–‡æœ¬æ¶ˆæ¯
        webhook = self._select_best_webhook()
        webhook.rate_limiter.acquire()
        success, error = self._raw_sender.send_mention_all(webhook.url)

        if success:
            webhook.mark_success()
            used_webhooks.add(webhook.url)
            return True
        else:
            return False
```

**å…³é”®ç‚¹**ï¼š
- âœ… å¤ç”¨åŸºç±»çš„è°ƒåº¦é€»è¾‘
- âœ… åªå®ç°ä¼å¾®ç‰¹å®šè¡Œä¸ºï¼ˆå›¾ç‰‡åˆ†æ®µã€@all workaroundï¼‰
- âœ… ä»£ç é‡å¤§å¹…å‡å°‘

#### 5.1.4 ä¸»ç±»æ¶æ„ (notifier.py)

```python
"""ä¼ä¸šå¾®ä¿¡é€šçŸ¥å™¨"""
from typing import List, Optional, Union
from wecom_notifier.core import RateLimiter, MessageSegmenter
from wecom_notifier.core.models import SendResult


class WeComNotifier:
    """ä¼ä¸šå¾®ä¿¡é€šçŸ¥å™¨"""

    def __init__(
        self,
        max_retries: int = 3,
        retry_delay: float = 2.0,
        enable_content_moderation: bool = False,
        moderation_config: Optional[dict] = None
    ):
        # æ ¸å¿ƒæ¨¡å—å®ä¾‹åŒ–
        self.segmenter = MessageSegmenter(max_bytes=MAX_BYTES_PER_MESSAGE)
        self.sender = WeComSender(...)
        self.moderator = ContentModerator(...) if enable_content_moderation else None

        # ç®¡ç†å™¨ç¼“å­˜
        self._managers = {}
        self._pools = {}
        self._rate_limiters = {}

    def send_text(self, webhook_url: Union[str, List[str]], content: str, ...) -> SendResult:
        """å‘é€æ–‡æœ¬æ¶ˆæ¯"""
        message = WeComMessage(content=content, msg_type=MSG_TYPE_TEXT, ...)
        return self._send_message(webhook_url, message, async_send)

    def send_markdown(self, webhook_url: Union[str, List[str]], content: str, ...) -> SendResult:
        """å‘é€Markdownæ¶ˆæ¯"""
        message = WeComMessage(content=content, msg_type=MSG_TYPE_MARKDOWN_V2, ...)
        return self._send_message(webhook_url, message, async_send)

    def send_image(self, webhook_url: Union[str, List[str]], ...) -> SendResult:
        """å‘é€å›¾ç‰‡æ¶ˆæ¯"""
        base64_data, md5_value = self.sender.prepare_image(...)
        message = WeComMessage(content=(base64_data, md5_value), msg_type=MSG_TYPE_IMAGE, ...)
        return self._send_message(webhook_url, message, async_send)
```

**å…³é”®ç‰¹æ€§**ï¼š
- å¤ç”¨ `core/` æ¨¡å—ï¼ˆRateLimiterã€MessageSegmenterï¼‰
- ä½¿ç”¨ `WeComMessage` æ‰©å±•æ¨¡å‹
- ç®¡ç†å™¨ç¼“å­˜ç¡®ä¿å•ä¾‹æ¨¡å¼
- æ”¯æŒå•webhookå’Œwebhookæ± ä¸¤ç§æ¨¡å¼

---

### 5.2 é£ä¹¦å¹³å° (platforms/feishu/)

#### 5.2.1 å¹³å°é…ç½® (config.py)

```python
"""é£ä¹¦å¹³å°é…ç½®"""

# æ¶ˆæ¯ç±»å‹
MSG_TYPE_TEXT = "text"
MSG_TYPE_INTERACTIVE = "interactive"  # å¡ç‰‡æ¶ˆæ¯

# åˆ†æ®µè®¾ç½®
MAX_BYTES_PER_MESSAGE = 19000  # å®é™…é™åˆ¶20KBï¼Œç•™å®‰å…¨ä½™é‡

# é¢‘ç‡é™åˆ¶
RATE_LIMIT_PER_MINUTE = 100
RATE_LIMIT_PER_SECOND = 5

# æœåŠ¡ç«¯é¢‘æ§é‡è¯•
RATE_LIMIT_MAX_RETRIES = 5
RATE_LIMIT_WAIT_TIME = 65

# é”™è¯¯ç 
CODE_SUCCESS = 0
CODE_RATE_LIMIT = 11232
CODE_KEYWORD_FAILED = 19024
CODE_IP_FAILED = 19022
CODE_SIGN_FAILED = 19021

# Webhook URLæ ¼å¼
WEBHOOK_URL_PATTERN = r"https://open\.feishu\.cn/open-apis/bot/v2/hook/[\w-]+"

# å¡ç‰‡é…ç½®
DEFAULT_CARD_TEMPLATE = "blue"
```

#### 5.2.2 åè®®é€‚é…å™¨ï¼ˆadapter.pyï¼‰ğŸ†•

**ä½œç”¨**ï¼šå®ç°é£ä¹¦çš„åè®®é€‚é…å™¨å’Œæ¶ˆæ¯è½¬æ¢å™¨ã€‚

```python
"""é£ä¹¦å¹³å°é€‚é…å™¨"""
from wecom_notifier.core.protocols import SenderProtocol, MessageConverterProtocol
from .sender import FeishuSender
from .constants import MSG_TYPE_TEXT, MSG_TYPE_INTERACTIVE


class FeishuSenderAdapter(SenderProtocol):
    """é£ä¹¦å‘é€å™¨é€‚é…å™¨"""

    def __init__(self, sender: FeishuSender):
        self._sender = sender

    def send(
        self,
        webhook_url: str,
        msg_type: str,
        content: Any,
        metadata: Optional[dict] = None
    ) -> Tuple[bool, Optional[str]]:
        """ç»Ÿä¸€å‘é€æ¥å£"""
        metadata = metadata or {}

        if msg_type == MSG_TYPE_TEXT:
            # é£ä¹¦çš„@åŠŸèƒ½å·²ç»åœ¨contentä¸­å¤„ç†ï¼ˆ<at>æ ‡ç­¾ï¼‰
            return self._sender.send_text(webhook_url, content)
        elif msg_type == MSG_TYPE_INTERACTIVE:
            # å¡ç‰‡æ¶ˆæ¯
            return self._sender.send_card(
                webhook_url=webhook_url,
                content=content,
                title=metadata.get('title', 'é€šçŸ¥'),
                template=metadata.get('template', 'blue')
            )
        else:
            return False, f"Unsupported message type: {msg_type}"


class FeishuMessageConverter(MessageConverterProtocol):
    """é£ä¹¦æ¶ˆæ¯è½¬æ¢å™¨"""

    def prepare_send_params(
        self,
        msg_type: str,
        content: Any,
        message_metadata: dict
    ) -> Tuple[str, Any, dict]:
        """å‡†å¤‡é£ä¹¦å‘é€å‚æ•°"""
        feishu_extras = message_metadata.get('feishu', {})

        # å¤„ç†@åŠŸèƒ½ï¼ˆæ’å…¥<at>æ ‡ç­¾ï¼‰
        if msg_type == MSG_TYPE_TEXT:
            mentions = feishu_extras.get('mentions', [])
            if mentions:
                at_tags = []
                for user_id in mentions:
                    if user_id == "all":
                        at_tags.append("<at user_id='all'>æ‰€æœ‰äºº</at>")
                    else:
                        at_tags.append(f"<at user_id='{user_id}'></at>")
                content = " ".join(at_tags) + " " + content

        # å¡ç‰‡å…ƒæ•°æ®
        metadata = {}
        if msg_type == MSG_TYPE_INTERACTIVE:
            metadata['title'] = feishu_extras.get('title', 'é€šçŸ¥')
            metadata['template'] = feishu_extras.get('template', 'blue')

        return msg_type, content, metadata
```

#### 5.2.3 æ¶ˆæ¯æ ¼å¼è½¬æ¢å™¨ (converter.py)

**è¯´æ˜**ï¼šåŸè®¾è®¡ä¸­çš„ `converter.py` åŠŸèƒ½ç°åœ¨æ•´åˆåˆ° `adapter.py` ä¸­çš„ `FeishuMessageConverter`ã€‚

```python
"""é£ä¹¦æ¶ˆæ¯æ ¼å¼è½¬æ¢å™¨"""
from typing import Optional, List


class FeishuMessageConverter:
    """é£ä¹¦æ¶ˆæ¯æ ¼å¼è½¬æ¢"""

    @staticmethod
    def convert_text(
        content: str,
        mentioned_list: Optional[List[str]] = None
    ) -> dict:
        """
        è½¬æ¢æ–‡æœ¬æ¶ˆæ¯

        é£ä¹¦@åŠŸèƒ½ï¼šéœ€è¦åœ¨æ–‡æœ¬ä¸­æ’å…¥<at>æ ‡ç­¾
        """
        # å¤„ç†@åŠŸèƒ½
        if mentioned_list:
            at_tags = []
            for user_id in mentioned_list:
                if user_id == "all":
                    at_tags.append("<at user_id='all'>æ‰€æœ‰äºº</at>")
                else:
                    at_tags.append(f"<at user_id='{user_id}'></at>")

            if at_tags:
                content = " ".join(at_tags) + " " + content

        return {
            "msg_type": "text",
            "content": {
                "text": content
            }
        }

    @staticmethod
    def convert_markdown_to_card(
        content: str,
        title: str = "é€šçŸ¥",
        template: str = "blue"
    ) -> dict:
        """
        è½¬æ¢Markdownä¸ºé£ä¹¦å¡ç‰‡

        é£ä¹¦çš„interactiveæ¶ˆæ¯æ”¯æŒmarkdownç»„ä»¶
        """
        return {
            "msg_type": "interactive",
            "card": {
                "schema": "2.0",
                "header": {
                    "title": {
                        "tag": "plain_text",
                        "content": title
                    },
                    "template": template
                },
                "body": {
                    "elements": [
                        {
                            "tag": "markdown",
                            "content": content
                        }
                    ]
                }
            }
        }
```

#### 4.2.3 åŒå±‚é¢‘ç‡æ§åˆ¶ (rate_limiter.py)

```python
"""é£ä¹¦åŒå±‚é¢‘ç‡æ§åˆ¶å™¨"""
from wecom_notifier.core.rate_limiter import RateLimiter


class DualRateLimiter:
    """
    åŒå±‚é¢‘ç‡æ§åˆ¶å™¨

    é£ä¹¦é™åˆ¶ï¼š100æ¡/åˆ†é’Ÿ + 5æ¡/ç§’
    """

    def __init__(self, minute_limit: int = 100, second_limit: int = 5):
        self.minute_limiter = RateLimiter(max_count=minute_limit, time_window=60)
        self.second_limiter = RateLimiter(max_count=second_limit, time_window=1)

    def acquire(self):
        """è·å–è®¸å¯ï¼ˆåŒæ—¶æ»¡è¶³ä¸¤ä¸ªé™åˆ¶ï¼‰"""
        self.minute_limiter.acquire()
        self.second_limiter.acquire()

    def get_available_count(self) -> int:
        """è¿”å›ä¸¤ä¸ªé™åˆ¶ä¸­è¾ƒå°çš„å¯ç”¨é…é¢"""
        return min(
            self.minute_limiter.get_available_count(),
            self.second_limiter.get_available_count()
        )

    def is_available_now(self) -> bool:
        """ä¸¤ä¸ªé™åˆ¶éƒ½æœ‰é…é¢æ‰å¯ç”¨"""
        return (
            self.minute_limiter.is_available_now() and
            self.second_limiter.is_available_now()
        )
```

#### 4.2.4 ä¸»ç±»æ¶æ„ (notifier.py)

```python
"""é£ä¹¦é€šçŸ¥å™¨"""
from typing import List, Optional, Union
from wecom_notifier.core import MessageSegmenter
from wecom_notifier.core.moderation import ContentModerator
from wecom_notifier.core.models import SendResult, Message


class FeishuNotifier:
    """é£ä¹¦é€šçŸ¥å™¨"""

    def __init__(
        self,
        max_retries: int = 3,
        retry_delay: float = 2.0,
        enable_content_moderation: bool = False,
        moderation_config: Optional[dict] = None
    ):
        # æ ¸å¿ƒæ¨¡å—
        self.segmenter = MessageSegmenter(max_bytes=MAX_BYTES_PER_MESSAGE)
        self.sender = FeishuSender(max_retries=max_retries, retry_delay=retry_delay)
        self.converter = FeishuMessageConverter()

        # å†…å®¹å®¡æ ¸
        self.moderator = None
        if enable_content_moderation and moderation_config:
            self.moderator = ContentModerator(moderation_config)

        # ç®¡ç†å™¨ç¼“å­˜
        self._managers = {}
        self._rate_limiters = {}

    def send_text(
        self,
        webhook_url: Union[str, List[str]],
        content: str,
        mentioned_list: Optional[List[str]] = None,
        async_send: bool = True
    ) -> SendResult:
        """
        å‘é€æ–‡æœ¬æ¶ˆæ¯

        Args:
            mentioned_list: @çš„ç”¨æˆ·IDåˆ—è¡¨ï¼ˆuser_id/open_idï¼‰
                æ³¨æ„ï¼šé£ä¹¦ä¸æ”¯æŒæ‰‹æœºå·@
        """
        message = Message(
            content=content,
            msg_type=MSG_TYPE_TEXT,
            mentioned_list=mentioned_list
        )
        return self._send_message(webhook_url, message, async_send)

    def send_markdown(
        self,
        webhook_url: Union[str, List[str]],
        content: str,
        title: str = "é€šçŸ¥",
        template: str = None,
        async_send: bool = True
    ) -> SendResult:
        """
        å‘é€Markdownæ¶ˆæ¯ï¼ˆè½¬ä¸ºé£ä¹¦å¡ç‰‡ï¼‰

        Args:
            title: å¡ç‰‡æ ‡é¢˜
            template: å¡ç‰‡é¢œè‰²ï¼ˆblue/green/red/greyç­‰ï¼‰
        """
        template = template or DEFAULT_CARD_TEMPLATE

        message = Message(
            content=content,
            msg_type=MSG_TYPE_INTERACTIVE,
            platform_extras={
                "title": title,
                "template": template
            }
        )
        return self._send_message(webhook_url, message, async_send)
```

### 4.3 å¹³å°å·®å¼‚å¯¹æ¯”

| ç‰¹æ€§ | ä¼ä¸šå¾®ä¿¡ | é£ä¹¦ |
|-----|---------|------|
| **æ¶ˆæ¯å¤§å°** | 4KB (3800å­—èŠ‚) | 20KB (19000å­—èŠ‚) |
| **é¢‘ç‡é™åˆ¶** | 20æ¡/åˆ†é’Ÿ | 100æ¡/åˆ†é’Ÿ + 5æ¡/ç§’ |
| **@åŠŸèƒ½** | mentioned_listå­—æ®µ | æ–‡æœ¬ä¸­æ’å…¥`<at>`æ ‡ç­¾ |
| **Markdown** | markdown_v2ç±»å‹ | interactiveå¡ç‰‡ |
| **@all workaround** | éœ€è¦ï¼ˆmarkdown/imageï¼‰ | ä¸éœ€è¦ |
| **é”™è¯¯ç ** | errcode | code |
| **å“åº”æ ¼å¼** | {errcode, errmsg} | {code, msg} |

---

## 6. å‘åå…¼å®¹è®¾è®¡

### 6.1 æ ¹ç›®å½• __init__.py

```python
"""
wecom-notifier v0.3.0+

æ”¯æŒå¤šå¹³å°ï¼š
- ä¼ä¸šå¾®ä¿¡ (WeComNotifier)
- é£ä¹¦ (FeishuNotifier)

å‘åå…¼å®¹ï¼š
- from wecom_notifier import WeComNotifier  # ä»å¯ç”¨
"""

# å‘åå…¼å®¹å¯¼å‡ºï¼ˆä¼ä¸šå¾®ä¿¡ï¼‰
from wecom_notifier.platforms.wecom import WeComNotifier
from wecom_notifier.platforms.wecom import WeComSender

# æ–°å¹³å°å¯¼å‡º
from wecom_notifier.platforms.feishu import FeishuNotifier

# å·¥å…·å‡½æ•°å¯¼å‡º
from wecom_notifier.core.logger import setup_logger, disable_logger, enable_logger

__version__ = "0.3.0"

__all__ = [
    # ä¼ä¸šå¾®ä¿¡ï¼ˆå‘åå…¼å®¹ï¼‰
    "WeComNotifier",
    "WeComSender",

    # é£ä¹¦ï¼ˆæ–°å¢ï¼‰
    "FeishuNotifier",

    # å·¥å…·
    "setup_logger",
    "disable_logger",
    "enable_logger",
]
```

### 6.2 å…¼å®¹æ€§å¯¼å…¥æ–‡ä»¶

ä¸ºäº†å®Œå…¨å‘åå…¼å®¹ï¼Œåœ¨æ ¹ç›®å½•åˆ›å»ºå…¼å®¹æ¨¡å—ï¼š

```python
# wecom_notifier/notifier.py (å‘åå…¼å®¹)
"""å‘åå…¼å®¹ï¼šä¿æŒæ—§çš„å¯¼å…¥è·¯å¾„"""
from wecom_notifier.platforms.wecom.notifier import WeComNotifier

__all__ = ["WeComNotifier"]
```

```python
# wecom_notifier/sender.py (å‘åå…¼å®¹)
from wecom_notifier.platforms.wecom.sender import WeComSender

__all__ = ["WeComSender"]
```

```python
# wecom_notifier/models.py (å‘åå…¼å®¹)
from wecom_notifier.core.models import Message, SendResult, SegmentInfo

__all__ = ["Message", "SendResult", "SegmentInfo"]
```

```python
# wecom_notifier/constants.py (å‘åå…¼å®¹)
from wecom_notifier.core.constants import *
from wecom_notifier.platforms.wecom.constants import *

# åˆå¹¶ä¸¤ä¸ªæ¨¡å—çš„å¸¸é‡
```

```python
# wecom_notifier/exceptions.py (å‘åå…¼å®¹)
from wecom_notifier.core.exceptions import *
from wecom_notifier.platforms.wecom.exceptions import *

# åˆå¹¶ä¸¤ä¸ªæ¨¡å—çš„å¼‚å¸¸
```

### 6.3 å…¼å®¹æ€§ä¿è¯

**å¿…é¡»ä¿æŒçš„API**ï¼š
```python
# è¿™äº›å¯¼å…¥è·¯å¾„å¿…é¡»ç»§ç»­å·¥ä½œ
from wecom_notifier import WeComNotifier
from wecom_notifier.models import Message, SendResult, SegmentInfo
from wecom_notifier.logger import setup_logger, get_logger
from wecom_notifier.constants import MSG_TYPE_TEXT, MSG_TYPE_MARKDOWN_V2
from wecom_notifier.exceptions import WeComError, NetworkError
```

**è¡Œä¸ºå…¼å®¹**ï¼š
- âœ… ç°æœ‰çš„å¼‚æ­¥/åŒæ­¥æ¨¡å¼
- âœ… ç°æœ‰çš„é¢‘ç‡æ§åˆ¶é€»è¾‘
- âœ… ç°æœ‰çš„åˆ†æ®µç®—æ³•
- âœ… ç°æœ‰çš„é‡è¯•æœºåˆ¶
- âœ… ç°æœ‰çš„å†…å®¹å®¡æ ¸åŠŸèƒ½

---

## 7. ä¾èµ–ä¼˜åŒ–

### 7.1 pyproject.toml æ›´æ–°

```toml
[build-system]
requires = ["setuptools<75", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "wecom-notifier"
version = "0.3.0"
description = "å¤šå¹³å°é€šçŸ¥ç»„ä»¶ï¼Œæ”¯æŒä¼ä¸šå¾®ä¿¡ã€é£ä¹¦ç­‰ï¼Œæä¾›é¢‘ç‡æ§åˆ¶ã€é•¿æ–‡æœ¬åˆ†æ®µã€å†…å®¹å®¡æ ¸ç­‰åŠŸèƒ½"
readme = "README.md"
license = { text = "MIT License" }
requires-python = ">=3.7"
authors = [
    {name = "ZLX", email = "zj1123581321@gmail.com"}
]
keywords = [
    "wecom", "wechat", "enterprise-wechat",
    "feishu", "lark",
    "robot", "notification", "webhook"
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "Topic :: Communications :: Chat",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.7",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3 :: Only",
    "Operating System :: OS Independent",
]

# æ ¸å¿ƒä¾èµ–ï¼ˆå¿…éœ€ï¼‰
dependencies = [
    "requests>=2.25.0",
    "loguru>=0.7.0",
]

# å¯é€‰ä¾èµ–
[project.optional-dependencies]
# å†…å®¹å®¡æ ¸åŠŸèƒ½
moderation = [
    "pypinyin>=0.44.0",      # æ‹¼éŸ³æ··æ·†ç­–ç•¥
    "pyahocorasick>=2.0.0",  # ACè‡ªåŠ¨æœº
]

# å…¨éƒ¨åŠŸèƒ½
all = [
    "pypinyin>=0.44.0",
    "pyahocorasick>=2.0.0",
]

# å¼€å‘å·¥å…·
dev = [
    "pytest>=6.0",
    "pytest-cov>=2.0",
    "build>=1.0.0",
    "twine>=4.0.0",
]

[project.urls]
"Homepage" = "https://github.com/zj1123581321/wecom-notifier"
"Bug Reports" = "https://github.com/zj1123581321/wecom-notifier/issues"
"Source" = "https://github.com/zj1123581321/wecom-notifier"
"Documentation" = "https://github.com/zj1123581321/wecom-notifier#readme"
"Changelog" = "https://github.com/zj1123581321/wecom-notifier/blob/main/CHANGELOG.md"

[tool.setuptools]
packages = ["wecom_notifier"]
license-files = ["LICENSE"]
```

### 7.2 å®‰è£…æ–¹å¼å¯¹æ¯”

| éœ€æ±‚ | å®‰è£…å‘½ä»¤ | åŒ…å«åŠŸèƒ½ |
|-----|---------|---------|
| **åŸºç¡€åŠŸèƒ½** | `pip install wecom-notifier` | ä¼å¾®+é£ä¹¦ï¼ˆä¸å«å®¡æ ¸ï¼‰ |
| **åŒ…å«å®¡æ ¸** | `pip install wecom-notifier[moderation]` | åŸºç¡€ + å†…å®¹å®¡æ ¸ |
| **å…¨éƒ¨åŠŸèƒ½** | `pip install wecom-notifier[all]` | æ‰€æœ‰åŠŸèƒ½ |
| **å¼€å‘æ¨¡å¼** | `pip install -e .[dev]` | å…¨éƒ¨ + å¼€å‘å·¥å…· |

### 7.3 è¿è¡Œæ—¶ä¾èµ–æ£€æŸ¥ï¼ˆé‡è¦ï¼‰ğŸ†•

ä¸ºäº†é¿å…ç”¨æˆ·å‡çº§åå› ç¼ºå°‘å¯é€‰ä¾èµ–å¯¼è‡´è¿è¡Œæ—¶å´©æºƒï¼Œéœ€è¦æ·»åŠ è¿è¡Œæ—¶æ£€æŸ¥ã€‚

```python
# core/moderation/moderator.py
class ContentModerator:
    def __init__(self, config: dict):
        # è¿è¡Œæ—¶æ£€æŸ¥ä¾èµ–
        try:
            import pyahocorasick
            import pypinyin
        except ImportError as e:
            from ..exceptions import ConfigurationError
            raise ConfigurationError(
                f"Content moderation requires additional dependencies.\n"
                f"Install with: pip install wecom-notifier[moderation]\n"
                f"Missing package: {e.name}"
            )

        # åŸæœ‰åˆå§‹åŒ–é€»è¾‘...
        self.config = config
        # ...
```

**å‡çº§åœºæ™¯ä¿æŠ¤**ï¼š
```python
# ç”¨æˆ·ä¹‹å‰çš„ä»£ç ï¼ˆv0.2.3ï¼‰
notifier = WeComNotifier(enable_content_moderation=True, ...)

# å‡çº§åˆ° v0.3.0 åï¼š
# 1. å¦‚æœå®‰è£…äº† [moderation]ï¼šæ­£å¸¸å·¥ä½œ âœ…
# 2. å¦‚æœæ²¡æœ‰å®‰è£…ï¼šæŠ›å‡ºå‹å¥½çš„é”™è¯¯æç¤º âœ…
# 3. ä¸ä¼šé»˜é»˜å¤±è´¥æˆ–å´©æºƒ âœ…
```

### 7.4 ä¾èµ–ä¼˜åŒ–æ•ˆæœ

**ä¼˜åŒ–å‰**ï¼ˆv0.2.3ï¼‰ï¼š
```
requests>=2.25.0
loguru>=0.7.0
pypinyin>=0.44.0       # æ‰€æœ‰ç”¨æˆ·å¿…è£…
pyahocorasick>=2.0.0   # æ‰€æœ‰ç”¨æˆ·å¿…è£…
```

**ä¼˜åŒ–å**ï¼ˆv0.3.0ï¼‰ï¼š
```
# å¿…éœ€ä¾èµ–
requests>=2.25.0
loguru>=0.7.0

# å¯é€‰ä¾èµ–ï¼ˆéœ€è¦æ—¶æ‰å®‰è£…ï¼‰
pypinyin>=0.44.0       [moderation]
pyahocorasick>=2.0.0   [moderation]
```

**ä¼˜åŠ¿**ï¼š
- ğŸš€ åŸºç¡€å®‰è£…æ›´å¿«ï¼ˆå‡å°‘2ä¸ªä¾èµ–ï¼‰
- ğŸ’¾ åŒ…ä½“ç§¯æ›´å°
- ğŸ¯ æŒ‰éœ€å®‰è£…ï¼Œæ›´çµæ´»

---

## 8. ä½¿ç”¨ç¤ºä¾‹

### 8.1 ä¼ä¸šå¾®ä¿¡ï¼ˆå‘åå…¼å®¹ï¼‰

```python
# æ–¹å¼1ï¼šæ—§çš„å¯¼å…¥æ–¹å¼ï¼ˆå‘åå…¼å®¹ï¼‰
from wecom_notifier import WeComNotifier

notifier = WeComNotifier()
result = notifier.send_text(
    webhook_url="https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR-KEY",
    content="Hello WeChat",
    async_send=True
)

# æ–¹å¼2ï¼šæ–°çš„å¯¼å…¥æ–¹å¼
from wecom_notifier.platforms.wecom import WeComNotifier

notifier = WeComNotifier()
```

### 8.2 é£ä¹¦ï¼ˆæ–°åŠŸèƒ½ï¼‰

```python
from wecom_notifier.platforms.feishu import FeishuNotifier

notifier = FeishuNotifier()

# å‘é€æ–‡æœ¬
result = notifier.send_text(
    webhook_url="https://open.feishu.cn/open-apis/bot/v2/hook/YOUR-TOKEN",
    content="Hello Feishu",
    mentioned_list=["all"]  # @æ‰€æœ‰äºº
)

# å‘é€Markdownï¼ˆè½¬ä¸ºå¡ç‰‡ï¼‰
result = notifier.send_markdown(
    webhook_url="https://open.feishu.cn/open-apis/bot/v2/hook/YOUR-TOKEN",
    content="""# éƒ¨ç½²é€šçŸ¥

## æ›´æ–°å†…å®¹
- æ–°å¢ç”¨æˆ·å¯¼å‡ºåŠŸèƒ½
- ä¿®å¤ç™»å½•è¶…æ—¶é—®é¢˜

| æµ‹è¯•é¡¹ | ç»“æœ |
|--------|------|
| å•å…ƒæµ‹è¯• | âœ… é€šè¿‡ |
| é›†æˆæµ‹è¯• | âœ… é€šè¿‡ |
""",
    title="ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²",
    template="green"  # ç»¿è‰²å¡ç‰‡
)
```

### 7.3 å†…å®¹å®¡æ ¸ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰

```python
from wecom_notifier.platforms.wecom import WeComNotifier

# å¯ç”¨å†…å®¹å®¡æ ¸
notifier = WeComNotifier(
    enable_content_moderation=True,
    moderation_config={
        "sensitive_word_urls": [
            "http://example.com/sensitive_words.txt"
        ],
        "strategy": "replace",  # block | replace | pinyin_reverse
        "log_sensitive_messages": True
    }
)

# å‘é€æ—¶è‡ªåŠ¨å®¡æ ¸
result = notifier.send_text(
    webhook_url=WEBHOOK_URL,
    content="åŒ…å«æ•æ„Ÿè¯çš„æ¶ˆæ¯"
)
# æ•æ„Ÿè¯ä¼šè¢«æ›¿æ¢ä¸º [æ•æ„Ÿè¯]
```

### 7.4 å¤šå¹³å°æ··åˆä½¿ç”¨

```python
from wecom_notifier.platforms.wecom import WeComNotifier
from wecom_notifier.platforms.feishu import FeishuNotifier

# åˆå§‹åŒ–
wecom = WeComNotifier()
feishu = FeishuNotifier()

# åŒä¸€æ¶ˆæ¯å‘é€åˆ°ä¸¤ä¸ªå¹³å°
message = "ã€å‘Šè­¦ã€‘æœåŠ¡å™¨CPUä½¿ç”¨ç‡è¶…è¿‡80%"

wecom.send_text(WECOM_WEBHOOK, message)
feishu.send_text(FEISHU_WEBHOOK, message)
```

### 7.5 Webhookæ± ï¼ˆçªç ´é¢‘ç‡é™åˆ¶ï¼‰

```python
from wecom_notifier.platforms.wecom import WeComNotifier

notifier = WeComNotifier()

# åœ¨åŒä¸€ä¸ªç¾¤èŠä¸­æ·»åŠ å¤šä¸ªæœºå™¨äººwebhook
webhook_pool = [
    "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=KEY1",
    "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=KEY2",
    "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=KEY3"
]

# ä¼ å…¥åˆ—è¡¨ï¼Œç³»ç»Ÿè‡ªåŠ¨è´Ÿè½½å‡è¡¡
result = notifier.send_text(
    webhook_url=webhook_pool,  # ä¼ å…¥åˆ—è¡¨
    content="æ‰¹é‡æ•°æ®æ¨é€...",
    async_send=False
)

# æŸ¥çœ‹ä½¿ç”¨æƒ…å†µ
print(f"ä½¿ç”¨çš„webhooks: {len(result.used_webhooks)}")
print(f"åˆ†æ®µæ•°: {result.segment_count}")
```

**æ€§èƒ½æå‡**ï¼š
- 1ä¸ªwebhookï¼š20æ¡/åˆ†é’Ÿ
- 3ä¸ªwebhookï¼š60æ¡/åˆ†é’Ÿ
- 10ä¸ªwebhookï¼š200æ¡/åˆ†é’Ÿ

---

## 9. å®æ–½è®¡åˆ’ï¼ˆè°ƒæ•´ä¸º4å‘¨ï¼‰

### 9.1 æ€»ä½“æ—¶é—´è¡¨

| é˜¶æ®µ | æ—¶é—´ | å…³é”®ä»»åŠ¡ |
|-----|------|---------|
| **Week 1** | Day 1-5 | åŸºç¡€é‡æ„ï¼ˆåè®®å±‚+é€‚é…å™¨ï¼‰ |
| **Week 2** | Day 6-10 | é£ä¹¦å¹³å°å¼€å‘ |
| **Week 3** | Day 11-15 | ä¾èµ–ä¼˜åŒ– + å®Œæ•´æµ‹è¯• |
| **Week 4** | Day 16-21 | æ–‡æ¡£ + Betaæµ‹è¯• + å‘å¸ƒ |

**è°ƒæ•´è¯´æ˜**ï¼š
- åŸè®¡åˆ’3å‘¨ï¼Œè°ƒæ•´ä¸º4å‘¨
- Week 1 é‡ç‚¹ï¼šå¼•å…¥åè®®å±‚ï¼Œæœ€å°åŒ–æ”¹åŠ¨
- Week 4 æ–°å¢ï¼šBetaæµ‹è¯•é˜¶æ®µï¼Œé™ä½é£é™©

### 9.2 Week 1: åŸºç¡€é‡æ„ï¼ˆå‘åå…¼å®¹ä¼˜å…ˆï¼‰

#### Day 1-2: åˆ›å»ºåè®®å±‚

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º `core/protocols.py`
  - [ ] å®šä¹‰ `SenderProtocol`
  - [ ] å®šä¹‰ `RateLimiterProtocol`
  - [ ] å®šä¹‰ `MessageConverterProtocol`
- [ ] è°ƒæ•´ `core/models.py`
  - [ ] æ·»åŠ  `Message.__post_init__`ï¼ˆå‘åå…¼å®¹è½¬æ¢ï¼‰
  - [ ] ä¿ç•™ `mentioned_list`/`mentioned_mobile_list` å­—æ®µ
  - [ ] æ–‡æ¡£æ›´æ–°
- [ ] æµ‹è¯•æ ¸å¿ƒæ¨¡å‹
  - [ ] æµ‹è¯• `__post_init__` å…¼å®¹æ€§è½¬æ¢
  - [ ] ç¡®ä¿ç°æœ‰åŠŸèƒ½ä¸å—å½±å“

**æµ‹è¯•**ï¼š
- [ ] è¿è¡Œç°æœ‰æµ‹è¯•ï¼Œç¡®ä¿æ²¡æœ‰ç ´å

#### Day 3-4: ä¼å¾®é€‚é…å™¨ä¸æ± é‡æ„

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º `core/pool_base.py`
  - [ ] æå– `webhook_pool.py` çš„é€šç”¨é€»è¾‘
  - [ ] å®šä¹‰æŠ½è±¡æ–¹æ³•ï¼ˆ`should_skip_segmentation` ç­‰ï¼‰
  - [ ] å®ç°é€šç”¨è°ƒåº¦æµç¨‹
- [ ] åˆ›å»º `platforms/wecom/adapter.py`
  - [ ] å®ç° `WeComSenderAdapter`ï¼ˆåŒ…è£…ç°æœ‰Senderï¼‰
  - [ ] å®ç° `WeComMessageConverter`
- [ ] è°ƒæ•´ `platforms/wecom/pool.py`ï¼ˆå¦‚æœéœ€è¦ç§»åŠ¨ï¼‰
  - [ ] ç»§æ‰¿ `WebhookPoolBase`
  - [ ] å®ç°æŠ½è±¡æ–¹æ³•
  - [ ] åˆ é™¤é‡å¤çš„é€šç”¨é€»è¾‘
- [ ] æ›´æ–° `WeComNotifier`
  - [ ] ä½¿ç”¨æ–°çš„ `WeComWebhookPool`ï¼ˆå¦‚æœè°ƒæ•´äº†ï¼‰
  - [ ] æµ‹è¯•å‘åå…¼å®¹

**æµ‹è¯•**ï¼š
- [ ] å®Œæ•´æµ‹è¯•ä¼å¾®åŠŸèƒ½
- [ ] ç¡®ä¿100%å‘åå…¼å®¹
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–é€‚é…å™¨

#### Day 5: å‘åå…¼å®¹éªŒè¯

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º/æ›´æ–°æ ¹ç›®å½•å…¼å®¹æ¨¡å—
  - [ ] `wecom_notifier/notifier.py` â†’ å¯¼å…¥ `platforms.wecom.notifier`
  - [ ] `wecom_notifier/sender.py` â†’ å¯¼å…¥ `platforms.wecom.sender`
  - [ ] `wecom_notifier/webhook_pool.py` â†’ å¯¼å…¥ `platforms.wecom.pool`ï¼ˆæ–°å¢ï¼‰
  - [ ] `wecom_notifier/models.py` â†’ å¯¼å…¥ `core.models`
- [ ] ç¼–å†™å‘åå…¼å®¹æµ‹è¯•
  - [ ] `test_backward_compatibility.py`
  - [ ] æµ‹è¯•æ‰€æœ‰æ—§å¯¼å…¥è·¯å¾„
  - [ ] æµ‹è¯•APIè¡Œä¸ºä¸€è‡´æ€§
  - [ ] æµ‹è¯• `Message` çš„å…¼å®¹æ€§è½¬æ¢
- [ ] è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
  - [ ] ç¡®ä¿100%å‘åå…¼å®¹
  - [ ] ä¿®å¤å‘ç°çš„é—®é¢˜

---

### 9.3 Week 2: é£ä¹¦å¹³å°å¼€å‘

#### Day 6-7: é£ä¹¦é…ç½®ä¸è½¬æ¢å™¨

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®ç° `platforms/feishu/config.py`
  - [ ] å®šä¹‰é£ä¹¦ç‰¹å®šå¸¸é‡ï¼ˆé”™è¯¯ç ã€é™åˆ¶ç­‰ï¼‰
  - [ ] å®šä¹‰æ¶ˆæ¯ç±»å‹
- [ ] å®ç° `platforms/feishu/converter.py`
  - [ ] `convert_text()` - æ–‡æœ¬æ¶ˆæ¯è½¬æ¢ï¼ˆå¤„ç†@æ ‡ç­¾ï¼‰
  - [ ] `convert_markdown_to_card()` - Markdownè½¬é£ä¹¦å¡ç‰‡
- [ ] å®ç° `platforms/feishu/exceptions.py`
  - [ ] `FeishuError`
  - [ ] `FeishuRateLimitError`
  - [ ] `FeishuKeywordError`
- [ ] å•å…ƒæµ‹è¯•
  - [ ] `test_feishu_converter.py`
  - [ ] æµ‹è¯•@allè½¬æ¢
  - [ ] æµ‹è¯•å¡ç‰‡æ ¼å¼

#### Day 8-9: é£ä¹¦å‘é€å™¨ä¸é¢‘æ§

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®ç° `platforms/feishu/sender.py`
  - [ ] HTTPå‘é€é€»è¾‘
  - [ ] é”™è¯¯ç å¤„ç†ï¼ˆCODE_SUCCESSã€CODE_RATE_LIMITç­‰ï¼‰
  - [ ] é‡è¯•æœºåˆ¶ï¼ˆå¤ç”¨é€šç”¨é‡è¯•é€»è¾‘ï¼‰
- [ ] å®ç° `platforms/feishu/rate_limiter.py`
  - [ ] `DualRateLimiter` ç±»
  - [ ] åˆ†é’Ÿçº§é™æµï¼ˆ100æ¡/åˆ†ï¼‰
  - [ ] ç§’çº§é™æµï¼ˆ5æ¡/ç§’ï¼‰
  - [ ] åŒé‡æ£€æŸ¥é€»è¾‘
- [ ] å•å…ƒæµ‹è¯•
  - [ ] `test_feishu_sender.py`
  - [ ] `test_feishu_rate_limiter.py`
  - [ ] æµ‹è¯•åŒå±‚é¢‘æ§

#### Day 10: é£ä¹¦ä¸»ç±»ä¸é›†æˆ

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®ç° `platforms/feishu/notifier.py`
  - [ ] `FeishuNotifier` ç±»
  - [ ] `send_text()` æ–¹æ³•
  - [ ] `send_markdown()` æ–¹æ³•ï¼ˆè½¬ä¸ºå¡ç‰‡ï¼‰
  - [ ] å†…éƒ¨æ¶ˆæ¯è·¯ç”±é€»è¾‘
- [ ] å®ç° `platforms/feishu/manager.py`
  - [ ] å‚è€ƒ `wecom/manager.py`
  - [ ] é€‚é…é£ä¹¦æ¶ˆæ¯æ ¼å¼
- [ ] é›†æˆæµ‹è¯•
  - [ ] `test_feishu_notifier.py`
  - [ ] ç«¯åˆ°ç«¯æµ‹è¯•
  - [ ] æ¨¡æ‹ŸHTTPå“åº”æµ‹è¯•

---

### 9.4 Week 3: ä¾èµ–ä¼˜åŒ– + å®Œæ•´æµ‹è¯•

#### Day 11-12: ä¾èµ–ä¼˜åŒ–

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ·»åŠ  `ContentModerator` è¿è¡Œæ—¶æ£€æŸ¥
  - [ ] åœ¨ `__init__` ä¸­æ£€æµ‹ pypinyin/pyahocorasick
  - [ ] æŠ›å‡ºå‹å¥½çš„ `ConfigurationError`
  - [ ] æç¤ºå®‰è£…å‘½ä»¤
- [ ] æ›´æ–° `pyproject.toml`
  - [ ] ç§»åŠ¨ pypinyin/pyahocorasick åˆ° `[moderation]`
  - [ ] æ›´æ–° keywordsï¼ˆæ·»åŠ  feishuã€larkï¼‰
  - [ ] æ›´æ–° description
- [ ] æµ‹è¯•å¯é€‰ä¾èµ–å®‰è£…
  - [ ] æµ‹è¯•åŸºç¡€å®‰è£…ï¼ˆæ— moderationï¼‰
  - [ ] æµ‹è¯• `[moderation]` å®‰è£…
  - [ ] æµ‹è¯•ç¼ºå°‘ä¾èµ–æ—¶çš„é”™è¯¯æç¤º

#### Day 13-14: å®Œæ•´æµ‹è¯•

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ ¸å¿ƒæ¨¡å—æµ‹è¯•
  - [ ] è¿è¡Œæ‰€æœ‰ `tests/core/` æµ‹è¯•
  - [ ] æ£€æŸ¥è¦†ç›–ç‡ â‰¥90%
  - [ ] ä¿®å¤å¤±è´¥ç”¨ä¾‹
- [ ] ä¼å¾®å¹³å°æµ‹è¯•
  - [ ] è¿è¡Œæ‰€æœ‰ `tests/platforms/wecom/` æµ‹è¯•
  - [ ] æ£€æŸ¥è¦†ç›–ç‡ â‰¥80%
  - [ ] ä¿®å¤å¤±è´¥ç”¨ä¾‹
- [ ] é£ä¹¦å¹³å°æµ‹è¯•
  - [ ] è¿è¡Œæ‰€æœ‰ `tests/platforms/feishu/` æµ‹è¯•
  - [ ] æ£€æŸ¥è¦†ç›–ç‡ â‰¥80%
  - [ ] ä¿®å¤å¤±è´¥ç”¨ä¾‹
- [ ] å‘åå…¼å®¹æµ‹è¯•
  - [ ] è¿è¡Œ `test_backward_compatibility.py`
  - [ ] 100%é€šè¿‡
- [ ] é›†æˆæµ‹è¯•
  - [ ] è·¨å¹³å°æµ‹è¯•
  - [ ] æ··åˆä½¿ç”¨æµ‹è¯•
  - [ ] ä¾èµ–å¯é€‰æ€§æµ‹è¯•

**æµ‹è¯•å‘½ä»¤**ï¼š
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# æ£€æŸ¥è¦†ç›–ç‡
pytest --cov=wecom_notifier --cov-report=html

# åªæµ‹è¯•æ ¸å¿ƒæ¨¡å—
pytest tests/core/ --cov=wecom_notifier/core

# åªæµ‹è¯•å‘åå…¼å®¹
pytest tests/test_backward_compatibility.py -v

# æµ‹è¯•ä¾èµ–å¯é€‰æ€§ï¼ˆåˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼‰
python -m venv test_env
pip install -e .  # åŸºç¡€å®‰è£…
# éªŒè¯ ContentModerator æŠ¥é”™å‹å¥½
```

#### Day 15: Bugä¿®å¤ä¸ä¼˜åŒ–

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ›´æ–° `README.md`
  - [ ] æ·»åŠ é£ä¹¦æ”¯æŒè¯´æ˜
  - [ ] æ›´æ–°å®‰è£…æ–¹å¼ï¼ˆå¯é€‰ä¾èµ–ï¼‰
  - [ ] æ›´æ–°ä½¿ç”¨ç¤ºä¾‹ï¼ˆä¸¤ä¸ªå¹³å°ï¼‰
  - [ ] æ›´æ–°åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨
- [ ] ç¼–å†™é£ä¹¦ä½¿ç”¨æ–‡æ¡£
  - [ ] `doc/feishu_usage.md`
  - [ ] å¿«é€Ÿå¼€å§‹
  - [ ] APIå‚è€ƒ
  - [ ] å¸¸è§é—®é¢˜
- [ ] ç¼–å†™æ¶æ„æ–‡æ¡£
  - [ ] `doc/architecture.md`
  - [ ] æ¶æ„å›¾
  - [ ] æ¨¡å—è¯´æ˜
  - [ ] è®¾è®¡å†³ç­–
- [ ] ç¼–å†™ç¤ºä¾‹ä»£ç 
  - [ ] `examples/wecom_basic.py`
  - [ ] `examples/wecom_advanced.py`
  - [ ] `examples/feishu_basic.py`
  - [ ] `examples/feishu_advanced.py`
  - [ ] `examples/multi_platform.py`
- [ ] æ›´æ–° `CHANGELOG.md`
  - [ ] æ·»åŠ  v0.3.0 å˜æ›´è®°å½•
  - [ ] Breaking changesï¼ˆå¦‚æœæœ‰ï¼‰
  - [ ] æ–°å¢åŠŸèƒ½
  - [ ] Bugä¿®å¤

#### Day 15: Bugä¿®å¤ä¸ä»£ç å®¡æŸ¥

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] ä¿®å¤æµ‹è¯•ä¸­å‘ç°çš„æ‰€æœ‰bug
- [ ] ä»£ç å®¡æŸ¥
  - [ ] æ£€æŸ¥æ‰€æœ‰åè®®å®ç°æ˜¯å¦æ­£ç¡®
  - [ ] æ£€æŸ¥å‘åå…¼å®¹æ€§
  - [ ] æ£€æŸ¥é”™è¯¯å¤„ç†
  - [ ] æ£€æŸ¥æ–‡æ¡£å­—ç¬¦ä¸²å®Œæ•´æ€§
- [ ] æ€§èƒ½æµ‹è¯•
  - [ ] å¯¹æ¯”é‡æ„å‰åçš„æ€§èƒ½
  - [ ] ç¡®ä¿æ— æ€§èƒ½å›å½’

---

### 9.5 Week 4: æ–‡æ¡£ + Betaæµ‹è¯• + å‘å¸ƒ

#### Day 16-18: æ–‡æ¡£æ›´æ–°

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ›´æ–° `README.md`
  - [ ] æ·»åŠ é£ä¹¦æ”¯æŒè¯´æ˜
  - [ ] æ›´æ–°å®‰è£…æ–¹å¼ï¼ˆå¯é€‰ä¾èµ–ï¼‰
  - [ ] æ›´æ–°ä½¿ç”¨ç¤ºä¾‹ï¼ˆä¸¤ä¸ªå¹³å°ï¼‰
  - [ ] æ›´æ–°åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨
  - [ ] æ·»åŠ æ¶æ„å›¾
- [ ] ç¼–å†™é£ä¹¦ä½¿ç”¨æ–‡æ¡£
  - [ ] `doc/feishu_usage.md`
  - [ ] å¿«é€Ÿå¼€å§‹
  - [ ] APIå‚è€ƒ
  - [ ] å¸¸è§é—®é¢˜
  - [ ] ä¸ä¼å¾®çš„å·®å¼‚å¯¹æ¯”
- [ ] ç¼–å†™æ¶æ„æ–‡æ¡£
  - [ ] `doc/architecture.md`
  - [ ] æ¶æ„å›¾ï¼ˆåè®®å±‚ï¼‰
  - [ ] æ¨¡å—è¯´æ˜
  - [ ] è®¾è®¡å†³ç­–è¯´æ˜
  - [ ] æ‰©å±•æŒ‡å—ï¼ˆå¦‚ä½•æ·»åŠ æ–°å¹³å°ï¼‰
- [ ] ç¼–å†™ç¤ºä¾‹ä»£ç 
  - [ ] `examples/wecom_basic.py`
  - [ ] `examples/wecom_advanced.py`
  - [ ] `examples/feishu_basic.py`
  - [ ] `examples/feishu_advanced.py`
  - [ ] `examples/multi_platform.py`
- [ ] æ›´æ–° `CHANGELOG.md`
  - [ ] æ·»åŠ  v0.3.0 å˜æ›´è®°å½•
  - [ ] Breaking changesï¼ˆä¾èµ–å˜åŒ–ï¼‰
  - [ ] æ–°å¢åŠŸèƒ½ï¼ˆé£ä¹¦æ”¯æŒï¼‰
  - [ ] æ¶æ„æ”¹è¿›ï¼ˆåè®®å±‚ï¼‰
  - [ ] Bugä¿®å¤

#### Day 19-20: Betaæµ‹è¯•

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ›´æ–°ç‰ˆæœ¬å·ä¸º `0.3.0-beta.1`
  - [ ] `pyproject.toml` version â†’ "0.3.0b1"
  - [ ] `wecom_notifier/__init__.py` __version__ â†’ "0.3.0b1"
- [ ] æ„å»ºåˆ†å‘åŒ…
  ```bash
  python -m build
  ```
- [ ] æ£€æŸ¥åˆ†å‘åŒ…
  ```bash
  twine check dist/*
  ```
- [ ] å‘å¸ƒåˆ° TestPyPI
  ```bash
  twine upload --repository testpypi dist/*
  ```
- [ ] æœ¬åœ°æµ‹è¯•å®‰è£…
  ```bash
  # åˆ›å»ºæµ‹è¯•ç¯å¢ƒ
  python -m venv beta_test_env
  source beta_test_env/bin/activate  # Windows: beta_test_env\Scripts\activate

  # ä» TestPyPI å®‰è£…
  pip install --index-url https://test.pypi.org/simple/ wecom-notifier

  # æµ‹è¯•åŸºæœ¬åŠŸèƒ½
  python -c "from wecom_notifier import WeComNotifier, FeishuNotifier; print('OK')"

  # æµ‹è¯•å¯é€‰ä¾èµ–
  pip install wecom-notifier[moderation]
  ```
- [ ] é‚€è¯·ç”¨æˆ·æµ‹è¯•
  - [ ] åœ¨GitHubåˆ›å»ºBetaå‘å¸ƒ
  - [ ] é‚€è¯·3-5ä¸ªç”¨æˆ·æµ‹è¯•
  - [ ] æ”¶é›†åé¦ˆ
- [ ] æ ¹æ®åé¦ˆä¿®å¤é—®é¢˜
  - [ ] è®°å½•æ‰€æœ‰é—®é¢˜
  - [ ] ä¼˜å…ˆçº§æ’åº
  - [ ] ä¿®å¤å…³é”®é—®é¢˜
  - [ ] å‘å¸ƒ `0.3.0-beta.2`ï¼ˆå¦‚éœ€è¦ï¼‰

#### Day 21: æ­£å¼å‘å¸ƒ

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ›´æ–°ç‰ˆæœ¬å·ä¸º `0.3.0`
  - [ ] `pyproject.toml` version â†’ "0.3.0"
  - [ ] `wecom_notifier/__init__.py` __version__ â†’ "0.3.0"
- [ ] æœ€ç»ˆæ£€æŸ¥
  - [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
  - [ ] æ–‡æ¡£å®Œæ•´
  - [ ] CHANGELOG å®Œæ•´
  - [ ] ç¤ºä¾‹ä»£ç å¯è¿è¡Œ
- [ ] æ„å»ºåˆ†å‘åŒ…
  ```bash
  python -m build
  ```
- [ ] å‘å¸ƒåˆ° PyPI
  ```bash
  twine upload dist/*
  ```
- [ ] æ‰“ Git æ ‡ç­¾
  ```bash
  git tag -a v0.3.0 -m "Release version 0.3.0: å¤šå¹³å°æ”¯æŒ + åè®®æŠ½è±¡å±‚"
  git push origin v0.3.0
  ```
- [ ] åˆ›å»º GitHub Release
  - [ ] é™„åŠ åˆ†å‘åŒ…
  - [ ] å¤åˆ¶ CHANGELOG å†…å®¹
  - [ ] æ·»åŠ å‡çº§æŒ‡å—
- [ ] å‘å¸ƒå…¬å‘Š
  - [ ] æ›´æ–° GitHub README
  - [ ] ç¤¾åŒºå…¬å‘Šï¼ˆå¦‚æœæœ‰ï¼‰

### 9.6 å®æ–½å‰æä¸åˆ†é˜¶æ®µè½åœ°ï¼ˆæ–°å¢ï¼‰

#### 9.6.1 ç«‹é¡¹å‰æï¼ˆä¸æ»¡è¶³åˆ™ä¸è¿›å…¥å¹³å°æ‰©å±•é˜¶æ®µï¼‰
- âœ… **å…¼å®¹å±‚è®¾è®¡å®Œæˆ**ï¼šæ—§å¯¼å…¥è·¯å¾„ä¸è¡Œä¸ºåœ¨ä»£ç å±‚æœ‰æ˜ç¡®æ˜ å°„
- âœ… **æ ¸å¿ƒæ‹†åˆ†å¯è¡Œ**ï¼š`core/` ä¸ `platforms/` æ‹†åˆ†æ–¹æ¡ˆåœ¨ç°æœ‰ä»£ç ä¸­å¯è½åœ°
- âœ… **å›å½’æµ‹è¯•è®¡åˆ’æ˜ç¡®**ï¼šè‡³å°‘è¦†ç›–æ—§ API è¡Œä¸ºä¸ webhook pool å…³é”®è·¯å¾„

#### 9.6.2 æ¨èè½åœ°é¡ºåºï¼ˆé™ä½å¤±è´¥æ¦‚ç‡ï¼‰
**Phase 1ï¼šä»…æ‹† core + å…¼å®¹å¯¼å‡ºï¼ˆä¸å¼•å…¥æ–°å¹³å°ï¼‰**
- æŠ½å– `rate_limiter`ã€`segmenter`ã€`models`ã€`logger` ç­‰åˆ° `core/`
- ä¿ç•™ç°æœ‰å¯¹å¤– API ä¸å¯¼å…¥è·¯å¾„
- å®Œæˆ `test_backward_compatibility.py`

**Phase 2ï¼šå¼•å…¥åè®®å±‚ + é€‚é…å™¨ï¼ˆä»åªæ”¯æŒ WeComï¼‰**
- æ·»åŠ  `SenderProtocol` / `RateLimiterProtocol` / `MessageConverterProtocol`
- ä»¥é€‚é…å™¨åŒ…è£…ç°æœ‰ WeCom Sender
- éªŒè¯æ€§èƒ½æ— å›å½’

**Phase 3ï¼šæŠ½ WebhookPoolBaseï¼ˆä¿æŒè¡Œä¸ºä¸€è‡´ï¼‰**
- ä» `webhook_pool.py` ä¸­æå–é€šç”¨è°ƒåº¦é€»è¾‘
- å¹³å°ç‰¹å®šé€»è¾‘é€šè¿‡æŠ½è±¡æ–¹æ³•éš”ç¦»
- ä¿æŒåˆ†æ®µã€å®¡æ ¸ã€@all workaround è¡Œä¸ºä¸€è‡´

**Phase 4ï¼šæ–°å¢ Feishu æœ€å°å®ç°**
- ä»…å®ç°æ–‡æœ¬ + åŸºç¡€å¡ç‰‡ï¼ˆä¸è¿½æ±‚åŠŸèƒ½å®Œå…¨ï¼‰
- å®Œæˆæœ€å°æµ‹è¯•ä¸ç¤ºä¾‹

**Phase 5ï¼šå¯é€‰ä¾èµ–ä¸æ–‡æ¡£å‡çº§**
- moderation ä¾èµ–æ”¹ä¸º extras
- README ä¸æ–‡æ¡£åŒæ­¥æ›´æ–°

---

## 10. æµ‹è¯•ç­–ç•¥

### 10.1 æµ‹è¯•ç›®æ ‡

| æ¨¡å— | è¦†ç›–ç‡ç›®æ ‡ | æµ‹è¯•é‡ç‚¹ |
|-----|-----------|---------|
| **core/** | â‰¥90% | é¢‘æ§ç®—æ³•ã€åˆ†æ®µé€»è¾‘ã€å®¡æ ¸åŠŸèƒ½ |
| **platforms/wecom/** | â‰¥80% | å‘é€é€»è¾‘ã€é‡è¯•æœºåˆ¶ã€é”™è¯¯å¤„ç† |
| **platforms/feishu/** | â‰¥80% | åŒå±‚é¢‘æ§ã€å¡ç‰‡è½¬æ¢ã€é”™è¯¯ç å¤„ç† |
| **å‘åå…¼å®¹** | 100% | æ‰€æœ‰æ—§å¯¼å…¥è·¯å¾„ã€APIè¡Œä¸º |

### 9.2 æµ‹è¯•ç”¨ä¾‹æ¸…å•

#### æ ¸å¿ƒæ¨¡å—æµ‹è¯•

**test_rate_limiter.py**ï¼š
- [ ] æ»‘åŠ¨çª—å£ç®—æ³•æ­£ç¡®æ€§
- [ ] é¢‘ç‡é™åˆ¶é˜»å¡ç­‰å¾…
- [ ] æ—¶é—´çª—å£è¿‡æœŸæ¸…ç†
- [ ] çº¿ç¨‹å®‰å…¨æ€§
- [ ] `get_available_count()` å‡†ç¡®æ€§
- [ ] `mark_server_rate_limited()` é”å®šæœŸ

**test_segmenter.py**ï¼š
- [ ] æ–‡æœ¬åˆ†æ®µï¼ˆæŒ‰è¡Œï¼‰
- [ ] Markdownåˆ†æ®µï¼ˆä¿æŠ¤è¯­æ³•ï¼‰
- [ ] è¡¨æ ¼åˆ†æ®µï¼ˆä¿ç•™è¡¨å¤´ï¼‰
- [ ] ä»£ç å—ä¿æŠ¤
- [ ] é“¾æ¥/å›¾ç‰‡ä¿æŠ¤
- [ ] é¡µç æ·»åŠ 
- [ ] è¶…é•¿è¡Œå¤„ç†

**test_moderation.py**ï¼š
- [ ] ACè‡ªåŠ¨æœºæ„å»º
- [ ] æ•æ„Ÿè¯æ£€æµ‹
- [ ] Blockç­–ç•¥
- [ ] Replaceç­–ç•¥
- [ ] PinyinReverseç­–ç•¥
- [ ] æ•æ„Ÿæ¶ˆæ¯æ—¥å¿—

**test_webhook_pool.py**ï¼š
- [ ] è´Ÿè½½å‡è¡¡é€‰æ‹©
- [ ] å†·å´æœºåˆ¶
- [ ] å®¹é”™æ¢å¤
- [ ] æ¶ˆæ¯é¡ºåºä¿è¯

#### ä¼å¾®å¹³å°æµ‹è¯•

**test_wecom_sender.py**ï¼š
- [ ] æˆåŠŸå‘é€
- [ ] ç½‘ç»œé”™è¯¯é‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- [ ] é¢‘æ§é”™è¯¯é‡è¯•ï¼ˆå›ºå®š65ç§’ï¼‰
- [ ] Webhookæ— æ•ˆé”™è¯¯ï¼ˆä¸é‡è¯•ï¼‰
- [ ] é”™è¯¯ç å¤„ç†

**test_wecom_notifier.py**ï¼š
- [ ] send_text() å®Œæ•´æµç¨‹
- [ ] send_markdown() å®Œæ•´æµç¨‹
- [ ] send_image() å®Œæ•´æµç¨‹
- [ ] å¼‚æ­¥/åŒæ­¥æ¨¡å¼
- [ ] @all workaround
- [ ] åˆ†æ®µå‘é€

**test_wecom_pool.py**ï¼š
- [ ] Webhookæ± è´Ÿè½½å‡è¡¡
- [ ] å¤šwebhookå‘é€
- [ ] å¤±è´¥è‡ªåŠ¨åˆ‡æ¢

#### é£ä¹¦å¹³å°æµ‹è¯•

**test_feishu_converter.py**ï¼š
- [ ] æ–‡æœ¬æ¶ˆæ¯è½¬æ¢
- [ ] @allæ ‡ç­¾æ’å…¥
- [ ] Markdownè½¬å¡ç‰‡æ ¼å¼
- [ ] å¡ç‰‡é¢œè‰²/æ ‡é¢˜

**test_feishu_sender.py**ï¼š
- [ ] æˆåŠŸå‘é€
- [ ] é”™è¯¯ç å¤„ç†ï¼ˆCODE_RATE_LIMITã€CODE_KEYWORD_FAILEDç­‰ï¼‰
- [ ] é‡è¯•æœºåˆ¶

**test_feishu_rate_limiter.py**ï¼š
- [ ] åŒå±‚é¢‘æ§æ­£ç¡®æ€§
- [ ] åˆ†é’Ÿçº§é™æµï¼ˆ100æ¡/åˆ†ï¼‰
- [ ] ç§’çº§é™æµï¼ˆ5æ¡/ç§’ï¼‰
- [ ] `get_available_count()` è¿”å›æœ€å°å€¼

**test_feishu_notifier.py**ï¼š
- [ ] send_text() å®Œæ•´æµç¨‹
- [ ] send_markdown() è½¬å¡ç‰‡
- [ ] å¼‚æ­¥/åŒæ­¥æ¨¡å¼
- [ ] åˆ†æ®µå‘é€

#### å‘åå…¼å®¹æµ‹è¯•

**test_backward_compatibility.py**ï¼š
```python
def test_import_wecom_notifier():
    """æµ‹è¯•æ—§å¯¼å…¥è·¯å¾„"""
    from wecom_notifier import WeComNotifier
    assert WeComNotifier is not None

def test_import_models():
    """æµ‹è¯•modelså¯¼å…¥"""
    from wecom_notifier.models import Message, SendResult
    assert Message is not None
    assert SendResult is not None

def test_import_logger():
    """æµ‹è¯•loggerå¯¼å…¥"""
    from wecom_notifier.logger import setup_logger, get_logger
    assert setup_logger is not None

def test_api_behavior():
    """æµ‹è¯•APIè¡Œä¸ºä¸€è‡´æ€§"""
    from wecom_notifier import WeComNotifier
    notifier = WeComNotifier()

    # åº”è¯¥æœ‰è¿™äº›æ–¹æ³•
    assert hasattr(notifier, 'send_text')
    assert hasattr(notifier, 'send_markdown')
    assert hasattr(notifier, 'send_image')
```

### 9.3 æµ‹è¯•æ‰§è¡Œæµç¨‹

```bash
# 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# 2. ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=wecom_notifier --cov-report=html --cov-report=term

# 3. æŸ¥çœ‹è¦†ç›–ç‡
open htmlcov/index.html  # macOS/Linux
start htmlcov/index.html  # Windows

# 4. æ£€æŸ¥è¦†ç›–ç‡æ˜¯å¦è¾¾æ ‡
# - core/ â‰¥ 90%
# - platforms/wecom/ â‰¥ 80%
# - platforms/feishu/ â‰¥ 80%
# - å‘åå…¼å®¹ 100%
```

---

## 11. å…³é”®æ³¨æ„äº‹é¡¹

### 11.1 å¿…é¡»ä¿æŒçš„å…¼å®¹æ€§

âœ… **APIå…¼å®¹**ï¼š
```python
# è¿™äº›å¯¼å…¥å¿…é¡»ç»§ç»­å·¥ä½œ
from wecom_notifier import WeComNotifier
from wecom_notifier.models import Message, SendResult, SegmentInfo
from wecom_notifier.logger import setup_logger, get_logger, disable_logger
from wecom_notifier.constants import MSG_TYPE_TEXT, MSG_TYPE_MARKDOWN_V2
from wecom_notifier.exceptions import WeComError, NetworkError
```

âœ… **è¡Œä¸ºå…¼å®¹**ï¼š
- ç°æœ‰çš„å¼‚æ­¥/åŒæ­¥æ¨¡å¼
- ç°æœ‰çš„é¢‘ç‡æ§åˆ¶é€»è¾‘ï¼ˆ20æ¡/åˆ†é’Ÿï¼‰
- ç°æœ‰çš„åˆ†æ®µç®—æ³•ï¼ˆ3800å­—èŠ‚é™åˆ¶ï¼‰
- ç°æœ‰çš„é‡è¯•æœºåˆ¶ï¼ˆç½‘ç»œé”™è¯¯3æ¬¡ï¼Œé¢‘æ§5æ¬¡ï¼‰
- ç°æœ‰çš„å†…å®¹å®¡æ ¸åŠŸèƒ½

âœ… **å¯¼å…¥å…¼å®¹æ€§ï¼ˆæ–°å¢å¼ºè°ƒï¼‰**ï¼š
- æ—§è·¯å¾„å¿…é¡»ä¿æŒå¯ç”¨ï¼Œä¾‹å¦‚ï¼š
  - `from wecom_notifier.sender import WeComSender`
  - `from wecom_notifier.webhook_pool import WebhookPool`
  - `from wecom_notifier.webhook_manager import WebhookManager`

âœ… **è¡Œä¸ºå…¼å®¹ï¼ˆæ–°å¢å¼ºè°ƒï¼‰**ï¼š
- WebhookPool çš„é€‰æ‹©ç­–ç•¥ä¸é¡ºåºä¿è¯ä¸å¯æ”¹å˜
- åˆ†æ®µé€»è¾‘ä¸â€œé¡µç æç¤ºâ€æ ¼å¼ä¸å¯æ”¹å˜

âœ… **å‚æ•°å…¼å®¹**ï¼š
```python
# WeComNotifier åˆå§‹åŒ–å‚æ•°ä¸å˜
notifier = WeComNotifier(
    max_retries=3,
    retry_delay=2.0,
    enable_content_moderation=False,
    moderation_config=None
)

# send_text() å‚æ•°ä¸å˜
notifier.send_text(
    webhook_url="...",
    content="...",
    mentioned_list=None,
    mentioned_mobile_list=None,
    async_send=True
)
```

### 11.2 å¯ä»¥æ”¹è¿›çš„åœ°æ–¹

ğŸ”§ **ä¾èµ–ä¼˜åŒ–**ï¼š
- pypinyin/pyahocorasick â†’ å¯é€‰ä¾èµ– `[moderation]`
- ç”¨æˆ·æŒ‰éœ€å®‰è£…

ğŸ”§ **ä»£ç ç»„ç»‡**ï¼š
- æ ¸å¿ƒé€»è¾‘æå–åˆ° `core/`
- å¹³å°é€»è¾‘éš”ç¦»åˆ° `platforms/`
- æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ

ğŸ”§ **æ‰©å±•æ€§**ï¼š
- æ·»åŠ æ–°å¹³å°æ›´å®¹æ˜“ï¼ˆåªéœ€å®ç° `platforms/xxx/`ï¼‰
- æ ¸å¿ƒç®—æ³•æ”¹è¿›ä¸å½±å“å¹³å°å±‚

### 11.3 ä¸å»ºè®®ä¿®æ”¹çš„åœ°æ–¹

âŒ **ä¸è¦ä¿®æ”¹**ï¼š
- ç°æœ‰çš„é¢‘æ§ç®—æ³•ï¼ˆæ»‘åŠ¨çª—å£ï¼Œå·²éªŒè¯ç¨³å®šï¼‰
- ç°æœ‰çš„åˆ†æ®µé€»è¾‘ï¼ˆå·²å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µï¼‰
- ç°æœ‰çš„é‡è¯•æœºåˆ¶ï¼ˆå·²å……åˆ†æµ‹è¯•ï¼‰
- ç°æœ‰çš„å…¬å¼€APIç­¾å

âŒ **ä¸è¦å¼•å…¥ç ´åæ€§å˜æ›´**ï¼š
- ä¸æ”¹å˜ `SendResult` çš„è¡Œä¸º
- ä¸æ”¹å˜ `Message` çš„ç»“æ„ï¼ˆé™¤éå‘åå…¼å®¹ï¼‰
- ä¸æ”¹å˜é”™è¯¯ç å«ä¹‰

### 11.4 ä»£ç è´¨é‡è¦æ±‚

**å‘½åè§„èŒƒ**ï¼š
- æ¨¡å—åï¼šå°å†™+ä¸‹åˆ’çº¿ (`rate_limiter.py`)
- ç±»åï¼šå¤§é©¼å³° (`WeComNotifier`)
- å‡½æ•°/å˜é‡ï¼šå°å†™+ä¸‹åˆ’çº¿ (`send_text`)
- å¸¸é‡ï¼šå¤§å†™+ä¸‹åˆ’çº¿ (`MAX_BYTES_PER_MESSAGE`)
- ç§æœ‰æ–¹æ³•ï¼šå•ä¸‹åˆ’çº¿å‰ç¼€ (`_send_one`)

**æ–‡æ¡£å­—ç¬¦ä¸²**ï¼š
```python
def send_text(
    self,
    webhook_url: str,
    content: str,
    mentioned_list: Optional[List[str]] = None
) -> SendResult:
    """
    å‘é€æ–‡æœ¬æ¶ˆæ¯

    Args:
        webhook_url: Webhookåœ°å€
        content: æ–‡æœ¬å†…å®¹
        mentioned_list: @çš„ç”¨æˆ·IDåˆ—è¡¨

    Returns:
        SendResult: å‘é€ç»“æœå¯¹è±¡

    Raises:
        ConfigurationError: é…ç½®é”™è¯¯
    """
    pass
```

**ç±»å‹æ³¨è§£**ï¼š
- æ‰€æœ‰å…¬å¼€APIå¿…é¡»æœ‰ç±»å‹æ³¨è§£
- ä½¿ç”¨ `typing` æ¨¡å—ï¼ˆ`Optional`ã€`List`ã€`Union`ç­‰ï¼‰

---

## 12. é£é™©è¯„ä¼°ä¸ç¼“è§£ï¼ˆæ›´æ–°ï¼‰

### 12.1 é£é™©çŸ©é˜µï¼ˆä¿®è®¢åï¼‰

| é£é™© | ä¿®å¤å‰ | ä¿®å¤å | ç¼“è§£æªæ–½ |
|-----|--------|--------|---------|
| **WebhookPoolè€¦åˆ** | ğŸ”´ é«˜ | ğŸŸ¢ ä½ | `WebhookPoolBase` + å¹³å°å­ç±»ç»§æ‰¿ |
| **Senderæ¥å£ä¸ç»Ÿä¸€** | ğŸ”´ é«˜ | ğŸŸ¢ ä½ | `SenderProtocol` + é€‚é…å™¨æ¨¡å¼ |
| **å‘åå…¼å®¹æ€§ç ´å** | ğŸŸ¡ ä¸­ | ğŸŸ¢ ä½ | `Message.__post_init__` + å®Œæ•´æµ‹è¯• |
| **ä¾èµ–å‡çº§å´©æºƒ** | ğŸŸ¡ ä¸­-é«˜ | ğŸŸ¢ ä½ | è¿è¡Œæ—¶æ£€æŸ¥ + å‹å¥½é”™è¯¯æç¤º |
| **é£ä¹¦APIå˜æ›´** | ğŸŸ¡ ä½-ä¸­ | ğŸŸ¢ ä½ | åè®®æŠ½è±¡ + `platform_extras` |
| **æ€§èƒ½ä¸‹é™** | ğŸŸ¡ ä½ | ğŸŸ¢ ä½ | é€‚é…å™¨é›¶å¼€é”€ + åŸºå‡†æµ‹è¯• |
| **æµ‹è¯•å¤æ‚åº¦** | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | åè®®éš”ç¦» + 4å‘¨å‘¨æœŸ |
| **æ–‡æ¡£ç»´æŠ¤** | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | Week 4ä¸“é—¨æ–‡æ¡£å‘¨ |
| **ç”¨æˆ·è¿ç§»å›°éš¾** | ğŸŸ¢ ä½ | ğŸŸ¢ ä½ | 100%å‘åå…¼å®¹ + Betaæµ‹è¯• |

**å…³é”®æ”¹è¿›æ€»ç»“**ï¼š
- âœ… **æ ¸å¿ƒæ¶æ„é£é™©é™ä½**ï¼šåè®®å±‚è§£å†³äº† WebhookPool å’Œ Sender çš„è€¦åˆé—®é¢˜
- âœ… **ä¾èµ–ç®¡ç†ä¼˜åŒ–**ï¼šè¿è¡Œæ—¶æ£€æŸ¥é¿å…å‡çº§å´©æºƒ
- âœ… **å‘åå…¼å®¹ä¿è¯**ï¼šé€šè¿‡ `__post_init__` è‡ªåŠ¨è½¬æ¢æ—§å­—æ®µ
- âš ï¸ **æµ‹è¯•å¤æ‚åº¦**ï¼šä»éœ€4å‘¨å‘¨æœŸåº”å¯¹ï¼Œä½†é£é™©å¯æ§

### 12.2 ç¼“è§£æªæ–½è¯¦è§£ï¼ˆæ›´æ–°ï¼‰

**WebhookPoolè€¦åˆï¼ˆå·²è§£å†³ï¼‰**ï¼š
- âœ… åˆ›å»º `WebhookPoolBase` æŠ½è±¡åŸºç±»
- âœ… æå–é€šç”¨è°ƒåº¦é€»è¾‘åˆ°åŸºç±»
- âœ… å¹³å°æ± ç»§æ‰¿åŸºç±»ï¼Œåªå®ç°ç‰¹å®šé€»è¾‘
- âœ… ä¾èµ–åè®®è€Œéå…·ä½“å®ç°

**Senderæ¥å£ä¸ç»Ÿä¸€ï¼ˆå·²è§£å†³ï¼‰**ï¼š
- âœ… å®šä¹‰ `SenderProtocol` ç»Ÿä¸€æ¥å£
- âœ… ä½¿ç”¨é€‚é…å™¨æ¨¡å¼åŒ…è£…ç°æœ‰ Sender
- âœ… ä¸ä¿®æ”¹åŸæœ‰ä»£ç ï¼Œä¿æŒå‘åå…¼å®¹
- âœ… æ–°å¹³å°ç›´æ¥å®ç°åè®®

**å‘åå…¼å®¹æ€§ç ´åï¼ˆé£é™©é™ä½ï¼‰**ï¼š
- âœ… `Message.__post_init__` è‡ªåŠ¨è½¬æ¢æ—§å­—æ®µ
- âœ… ä¿ç•™ `mentioned_list`/`mentioned_mobile_list`
- âœ… ç¼–å†™ `test_backward_compatibility.py`
- âœ… æµ‹è¯•æ‰€æœ‰æ—§å¯¼å…¥è·¯å¾„
- âœ… æµ‹è¯•APIè¡Œä¸ºä¸€è‡´æ€§
- âœ… Week 4 Betaæµ‹è¯•æ”¶é›†åé¦ˆ

**ä¾èµ–å‡çº§å´©æºƒï¼ˆå·²è§£å†³ï¼‰**ï¼š
- âœ… `ContentModerator.__init__` æ·»åŠ è¿è¡Œæ—¶æ£€æŸ¥
- âœ… å‹å¥½çš„é”™è¯¯æç¤ºï¼ˆåŒ…å«å®‰è£…å‘½ä»¤ï¼‰
- âœ… æµ‹è¯•ç¼ºå°‘ä¾èµ–æ—¶çš„é”™è¯¯æç¤º
- âœ… æ–‡æ¡£æ˜ç¡®è¯´æ˜å¯é€‰ä¾èµ–

**é£ä¹¦APIå˜æ›´ï¼ˆé£é™©é™ä½ï¼‰**ï¼š
- âœ… åè®®æŠ½è±¡éš”ç¦»å¹³å°å·®å¼‚
- âœ… `platform_extras` æ‰©å±•å­—æ®µ
- âœ… é€‚é…å™¨æ˜“äºä¿®æ”¹
- âœ… ç›‘æ§é£ä¹¦å®˜æ–¹æ–‡æ¡£æ›´æ–°

**æ€§èƒ½ä¸‹é™ï¼ˆå·²éªŒè¯æ— å½±å“ï¼‰**ï¼š
- âœ… é€‚é…å™¨æ¨¡å¼é›¶æ€§èƒ½å¼€é”€ï¼ˆä»…è½¬å‘è°ƒç”¨ï¼‰
- âœ… åŸºå‡†æµ‹è¯•å¯¹æ¯”ï¼ˆé‡æ„å‰åï¼‰
- âœ… åè®®åŸºäº `Protocol`ï¼ˆç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œæ— è¿è¡Œæ—¶å¼€é”€ï¼‰
- âœ… ä¼˜åŒ–å¯¼å…¥ï¼ˆé¿å…å¾ªç¯å¯¼å…¥ï¼‰

**æµ‹è¯•å¤æ‚åº¦ï¼ˆå‘¨æœŸè°ƒæ•´ï¼‰**ï¼š
- âœ… åè®®éš”ç¦»é™ä½æµ‹è¯•éš¾åº¦ï¼ˆMockåè®®ï¼‰
- âœ… è°ƒæ•´ä¸º4å‘¨å‘¨æœŸï¼ˆå¢åŠ æµ‹è¯•æ—¶é—´ï¼‰
- âœ… Week 3ä¸“é—¨æµ‹è¯•å‘¨
- âœ… è¦†ç›–ç‡è¦æ±‚ï¼šcore â‰¥90%ï¼Œplatforms â‰¥80%
- âœ… CI/CDè‡ªåŠ¨è¿è¡Œæµ‹è¯•

**æ–‡æ¡£ç»´æŠ¤ï¼ˆä¸“é—¨æ–‡æ¡£å‘¨ï¼‰**ï¼š
- âœ… Week 4 Day 16-18 ä¸“é—¨æ–‡æ¡£æ›´æ–°
- âœ… æ¶æ„å›¾è¯´æ˜åè®®å±‚è®¾è®¡
- âœ… æ‰©å±•æŒ‡å—ï¼ˆå¦‚ä½•æ·»åŠ æ–°å¹³å°ï¼‰
- âœ… Betaæµ‹è¯•æœŸé—´åŒæ­¥æ›´æ–°æ–‡æ¡£

---

## 13. æˆåŠŸæ ‡å‡†ï¼ˆæ›´æ–°ï¼‰

### 13.1 åŠŸèƒ½å®Œæ•´æ€§

**å¿…é¡»æ»¡è¶³**ï¼š
- [x] ä¼ä¸šå¾®ä¿¡åŠŸèƒ½100%ä¿ç•™
- [ ] é£ä¹¦åŸºç¡€åŠŸèƒ½å®Œæ•´ï¼ˆæ–‡æœ¬ã€å¡ç‰‡ï¼‰
- [ ] å†…å®¹å®¡æ ¸åŠŸèƒ½å¯é€‰å¯ç”¨ï¼ˆmoderation extras + è¿è¡Œæ—¶æ£€æŸ¥ï¼‰
- [ ] Webhookæ± æ”¯æŒä¸¤ä¸ªå¹³å°ï¼ˆåŸºäº `WebhookPoolBase`ï¼‰
- [ ] å‘åå…¼å®¹100%ä¿è¯ï¼ˆ`Message.__post_init__` è½¬æ¢ï¼‰
- [ ] ğŸ†• åè®®å±‚å®Œæ•´å®ç°ï¼ˆ`SenderProtocol`, `RateLimiterProtocol`, `MessageConverterProtocol`ï¼‰
- [ ] ğŸ†• é€‚é…å™¨æ¨¡å¼å®ç°ï¼ˆä¼å¾®ã€é£ä¹¦ï¼‰

### 13.2 è´¨é‡æ ‡å‡†

**ä»£ç è´¨é‡**ï¼š
- [ ] æ ¸å¿ƒæ¨¡å—æµ‹è¯•è¦†ç›–ç‡ â‰¥90%
- [ ] å¹³å°æ¨¡å—æµ‹è¯•è¦†ç›–ç‡ â‰¥80%
- [ ] æ‰€æœ‰å‘åå…¼å®¹æµ‹è¯•é€šè¿‡ï¼ˆ100%ï¼‰
- [ ] æ— å·²çŸ¥ä¸¥é‡bug
- [ ] ä»£ç ç¬¦åˆPEP 8è§„èŒƒ
- [ ] æ‰€æœ‰å…¬å¼€APIæœ‰æ–‡æ¡£å­—ç¬¦ä¸²

**æ€§èƒ½æ ‡å‡†**ï¼š
- [ ] å¯¼å…¥é€Ÿåº¦ â‰¤ 0.5ç§’
- [ ] æ¶ˆæ¯å‘é€å»¶è¿Ÿ â‰¤ 100msï¼ˆä¸å«ç½‘ç»œæ—¶é—´ï¼‰
- [ ] å†…å­˜å ç”¨ â‰¤ 50MBï¼ˆç©ºé—²çŠ¶æ€ï¼‰

### 13.3 æ–‡æ¡£å®Œæ•´æ€§

**å¿…éœ€æ–‡æ¡£**ï¼š
- [ ] READMEåŒ…å«ä¸¤ä¸ªå¹³å°ä½¿ç”¨è¯´æ˜
- [ ] `doc/feishu_usage.md` é£ä¹¦ç‹¬ç«‹ä½¿ç”¨æ–‡æ¡£
- [ ] `doc/architecture.md` æ¶æ„è®¾è®¡æ–‡æ¡£
- [ ] å®Œæ•´çš„ä»£ç ç¤ºä¾‹ï¼ˆexamples/ï¼‰
- [ ] CHANGELOG.md æ›´æ–°åˆ° v0.3.0
- [ ] APIæ–‡æ¡£ï¼ˆdocstringï¼‰å®Œæ•´

### 13.4 å‘å¸ƒå°±ç»ª

**å‘å¸ƒæ£€æŸ¥æ¸…å•**ï¼š
- [ ] ç‰ˆæœ¬å·æ›´æ–°åˆ° 0.3.0
- [ ] CHANGELOGå®Œæ•´è®°å½•å˜æ›´
- [ ] PyPIå‘å¸ƒæˆåŠŸ
- [ ] GitHub Releaseåˆ›å»º
- [ ] Gitæ ‡ç­¾ v0.3.0 æ¨é€
- [ ] æ–‡æ¡£ç½‘ç«™æ›´æ–°ï¼ˆå¦‚æœæœ‰ï¼‰

**å‘å¸ƒæ£€æŸ¥æ¸…å•**ï¼š
- [ ] ç‰ˆæœ¬å·æ›´æ–°åˆ° 0.3.0
- [ ] CHANGELOGå®Œæ•´è®°å½•å˜æ›´
- [ ] PyPIå‘å¸ƒæˆåŠŸ
- [ ] GitHub Releaseåˆ›å»º
- [ ] Gitæ ‡ç­¾ v0.3.0 æ¨é€
- [ ] ğŸ†• Betaæµ‹è¯•å®Œæˆï¼ˆè‡³å°‘3-5ä¸ªç”¨æˆ·åé¦ˆï¼‰
- [ ] ğŸ†• è¿è¡Œæ—¶ä¾èµ–æ£€æŸ¥æµ‹è¯•é€šè¿‡

### 13.5 éªŒæ”¶æ ‡å‡†

**ç”¨æˆ·è§’åº¦**ï¼š
```python
# 1. æ—§ç”¨æˆ·ä»£ç æ— éœ€ä¿®æ”¹
from wecom_notifier import WeComNotifier
notifier = WeComNotifier()
notifier.send_text(webhook_url, "Hello")  # âœ… æ­£å¸¸å·¥ä½œ

# 2. æ–°ç”¨æˆ·å¯ä»¥ä½¿ç”¨é£ä¹¦
from wecom_notifier.platforms.feishu import FeishuNotifier
feishu = FeishuNotifier()
feishu.send_text(webhook_url, "Hello")  # âœ… æ­£å¸¸å·¥ä½œ

# 3. å¯é€‰ä¾èµ–æŒ‰éœ€å®‰è£…
pip install wecom-notifier  # âœ… åŸºç¡€åŠŸèƒ½
pip install wecom-notifier[moderation]  # âœ… åŒ…å«å®¡æ ¸

# 4. æ–‡æ¡£æ¸…æ™°æ˜“æ‡‚
# - READMEå¿«é€Ÿå¼€å§‹ < 5åˆ†é’Ÿ
# - ç¤ºä¾‹ä»£ç å¯ç›´æ¥è¿è¡Œ
# - å¸¸è§é—®é¢˜æœ‰è§£ç­”
```

---

## é™„å½•

### A. å‚è€ƒèµ„æº

**å®˜æ–¹æ–‡æ¡£**ï¼š
- [ä¼ä¸šå¾®ä¿¡æœºå™¨äººAPI](https://developer.work.weixin.qq.com/document/path/91770)
- [é£ä¹¦æœºå™¨äººAPI](https://open.feishu.cn/document/ukTMukTMukTM/ucTM5YjL3ETO24yNxkjN)
- [Pythonæ‰“åŒ…æŒ‡å—](https://packaging.python.org/)
- [Semantic Versioning](https://semver.org/)

**æŠ€æœ¯æ ‡å‡†**ï¼š
- [PEP 8 - Pythonä»£ç é£æ ¼](https://peps.python.org/pep-0008/)
- [PEP 257 - Docstringè§„èŒƒ](https://peps.python.org/pep-0257/)
- [PEP 484 - ç±»å‹æ³¨è§£](https://peps.python.org/pep-0484/)

### B. Gitæäº¤è§„èŒƒ

ä½¿ç”¨ Conventional Commitsï¼š

```
feat: æ·»åŠ é£ä¹¦å¹³å°æ”¯æŒ
fix: ä¿®å¤é¢‘ç‡æ§åˆ¶å™¨å¹¶å‘é—®é¢˜
docs: æ›´æ–°æ¶æ„è®¾è®¡æ–‡æ¡£
test: æ·»åŠ å‘åå…¼å®¹æ€§æµ‹è¯•
refactor: é‡æ„æ ¸å¿ƒæ¨¡å—
chore: æ›´æ–°ä¾èµ–ç‰ˆæœ¬
```

### C. ç‰ˆæœ¬å·è§„èŒƒ

éµå¾ª Semantic Versioning (SemVer)ï¼š

- **ä¸»ç‰ˆæœ¬å·**ï¼šä¸å…¼å®¹çš„APIå˜æ›´ï¼ˆ1.0.0 â†’ 2.0.0ï¼‰
- **æ¬¡ç‰ˆæœ¬å·**ï¼šå‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢ï¼ˆ0.2.3 â†’ 0.3.0ï¼‰
- **ä¿®è®¢å·**ï¼šå‘åå…¼å®¹çš„é—®é¢˜ä¿®æ­£ï¼ˆ0.3.0 â†’ 0.3.1ï¼‰

**ç¤ºä¾‹**ï¼š
- `0.2.3` â†’ `0.3.0`ï¼ˆæ–°å¢é£ä¹¦å¹³å°ï¼Œå‘åå…¼å®¹ï¼‰
- `0.3.0` â†’ `0.3.1`ï¼ˆä¿®å¤bugï¼‰
- `0.3.1` â†’ `1.0.0`ï¼ˆç ´åæ€§å˜æ›´ï¼Œå¦‚æ”¹åŒ…åï¼‰

---

**æ–‡æ¡£ç»´æŠ¤**ï¼š
- è¯·åœ¨æ¯æ¬¡æ¶æ„è°ƒæ•´åæ›´æ–°æ­¤æ–‡æ¡£
- åœ¨é¡¹ç›®Issueä¸­åé¦ˆæ–‡æ¡£é—®é¢˜
- å®šæœŸå®¡æŸ¥æ–‡æ¡£ä¸å®é™…ä»£ç çš„ä¸€è‡´æ€§

**ç‰ˆæœ¬å†å²**ï¼š
- v1.0 (2026-01-31): åˆå§‹ç‰ˆæœ¬
- v1.1 (2026-01-31):
  - å¼•å…¥åè®®å±‚è®¾è®¡ï¼ˆ`SenderProtocol`, `RateLimiterProtocol`, `MessageConverterProtocol`ï¼‰
  - æ·»åŠ  `WebhookPoolBase` æŠ½è±¡åŸºç±»
  - æ·»åŠ é€‚é…å™¨æ¨¡å¼å®ç°æ–¹æ¡ˆ
  - è°ƒæ•´å®æ–½è®¡åˆ’ä¸º4å‘¨ï¼ˆå¢åŠ Betaæµ‹è¯•ï¼‰
  - æ·»åŠ è¿è¡Œæ—¶ä¾èµ–æ£€æŸ¥æ–¹æ¡ˆ
  - æ›´æ–°é£é™©è¯„ä¼°ï¼ˆé£é™©æ˜¾è‘—é™ä½ï¼‰
  - å®Œå–„ç¼“è§£æªæ–½è¯´æ˜
